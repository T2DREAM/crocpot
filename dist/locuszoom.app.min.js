/*! Locuszoom 0.11.0-beta.1 */
var LocusZoom=function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e){t.exports=d3},function(t){t.exports=JSON.parse('{"a":"0.11.0-beta.1"}')},function(t,e,i){"use strict";i.r(e),i.d(e,"version",(function(){return h.a})),i.d(e,"DataSources",(function(){return Ee})),i.d(e,"populate",(function(){return K})),i.d(e,"KnownDataSources",(function(){return k})),i.d(e,"DataLayers",(function(){return At})),i.d(e,"Layouts",(function(){return de})),i.d(e,"ScaleFunctions",(function(){return fe})),i.d(e,"TransformationFunctions",(function(){return ke}));var s={};i.r(s),i.d(s,"BaseSource",(function(){return u})),i.d(s,"RemoteSource",(function(){return p})),i.d(s,"AssociationLZ",(function(){return _})),i.d(s,"ConnectorSource",(function(){return w})),i.d(s,"GeneConstraintLZ",(function(){return m})),i.d(s,"GeneLZ",(function(){return f})),i.d(s,"GwasCatalogLZ",(function(){return g})),i.d(s,"LDLZ",(function(){return y})),i.d(s,"PheWASLZ",(function(){return v})),i.d(s,"RecombLZ",(function(){return x})),i.d(s,"StaticSource",(function(){return b}));var a={};i.r(a),i.d(a,"dimensions",(function(){return V})),i.d(a,"display_options",(function(){return ot})),i.d(a,"download",(function(){return Y})),i.d(a,"menu",(function(){return st})),i.d(a,"move_panel_down",(function(){return tt})),i.d(a,"move_panel_up",(function(){return X})),i.d(a,"region_scale",(function(){return W})),i.d(a,"resize_to_data",(function(){return at})),i.d(a,"set_state",(function(){return rt})),i.d(a,"shift_region",(function(){return et})),i.d(a,"remove_panel",(function(){return Q})),i.d(a,"title",(function(){return $})),i.d(a,"toggle_legend",(function(){return nt})),i.d(a,"zoom_region",(function(){return it}));var n={};i.r(n),i.d(n,"annotation_track",(function(){return _t})),i.d(n,"arcs",(function(){return gt})),i.d(n,"forest",(function(){return mt})),i.d(n,"category_forest",(function(){return xt})),i.d(n,"genes",(function(){return vt})),i.d(n,"line",(function(){return zt})),i.d(n,"orthogonal_line",(function(){return Et})),i.d(n,"scatter",(function(){return Nt})),i.d(n,"category_scatter",(function(){return St}));var o={};i.r(o),i.d(o,"tooltip",(function(){return se})),i.d(o,"dashboard_components",(function(){return ae})),i.d(o,"dashboard",(function(){return ne})),i.d(o,"data_layer",(function(){return oe})),i.d(o,"panel",(function(){return re})),i.d(o,"plot",(function(){return le}));var r={};i.r(r),i.d(r,"categorical_bin",(function(){return pe})),i.d(r,"if_value",(function(){return ce})),i.d(r,"interpolate",(function(){return ye})),i.d(r,"numerical_bin",(function(){return ue})),i.d(r,"ordinal_cycle",(function(){return _e}));var l={};i.r(l),i.d(l,"neglog10",(function(){return me})),i.d(l,"logtoscinotation",(function(){return xe})),i.d(l,"scinotation",(function(){return be})),i.d(l,"htmlescape",(function(){return ve})),i.d(l,"urlencode",(function(){return we}));var h=i(1);var d=class{constructor(){this._items=new Map}get(t){if(!this._items.has(t))throw new Error("Item not found: "+t);return this._items.get(t)}create(t,...e){return new(this.get(t))(...e)}add(t,e,i=!1){if(!i&&this._items.has(t))throw new Error(`Item ${t} is already defined`);return this._items.set(t,e),e}remove(t){return this._items.delete(t)}has(t){return this._items.has(t)}list(){return Array.from(this._items.keys())}};function c(t,e,i){if(e&&i||!e&&!i)throw new Error(t+' must provide a parameter specifying either "build" or "source". It should not specify both.');if(e&&!["GRCh37","GRCh38"].includes(e))throw new Error(t+" must specify a valid genome build number")}class u{constructor(t){this._enableCache=!0,this._cachedKey=null,this.__dependentSource=!1,this.parseInit(t)}parseInit(t){this.params=t.params||{}}getCacheKey(t,e,i){return this.getURL(t,e,i)}getURL(t,e,i){return this.url}fetchRequest(t,e,i){const s=this.getURL(t,e,i);return fetch(s).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.text()})}getRequest(t,e,i){let s;const a=this.getCacheKey(t,e,i);return this._enableCache&&void 0!==a&&a===this._cachedKey?s=Promise.resolve(this._cachedResponse):(s=this.fetchRequest(t,e,i),this._enableCache&&(this._cachedKey=a,this._cachedResponse=s)),s}getData(t,e,i,s){if(this.preGetData){const a=this.preGetData(t,e,i,s);this.pre&&(t=a.state||t,e=a.fields||e,i=a.outnames||i,s=a.trans||s)}return a=>this.__dependentSource&&a&&a.body&&!a.body.length?Promise.resolve(a):this.getRequest(t,a,e).then(t=>this.parseResponse(t,a,e,i,s))}normalizeResponse(t){if(Array.isArray(t))return t;const e=Object.keys(t),i=t[e[0]].length;if(!e.every((function(e){return t[e].length===i})))throw new Error(this.constructor.name+" expects a response in which all arrays of data are the same length");const s=[],a=Object.keys(t);for(let e=0;e<i;e++){const i={};for(let s=0;s<a.length;s++)i[a[s]]=t[a[s]][e];s.push(i)}return s}annotateData(t,e){return t}extractFields(t,e,i,s){if(!Array.isArray(t))return t;if(!t.length)return t;const a=[];for(let t=0;t<e.length;t++)a[t]=0;const n=t.map((function(t){const n={};for(let o=0;o<e.length;o++){let r=t[e[o]];void 0!==r&&(a[o]=1),s&&s[o]&&(r=s[o](r)),n[i[o]]=r}return n}));return a.forEach((function(t,s){if(!t)throw new Error("field "+e[s]+" not found in response for "+i[s])})),n}combineChainBody(t,e,i,s,a){return t}parseResponse(t,e,i,s,a){const n=this.source_id||this.constructor.name;e.discrete||(e.discrete={});const o="string"==typeof t?JSON.parse(t):t;return Promise.resolve(this.normalizeResponse(o.data||o)).then(t=>Promise.resolve(this.annotateData(t,e))).then(t=>Promise.resolve(this.extractFields(t,i,s,a))).then(t=>(e.discrete[n]=t,Promise.resolve(this.combineChainBody(t,e,i,s,a)))).then(t=>({header:e.header||{},discrete:e.discrete,body:t}))}}class p extends u{parseInit(t){if(super.parseInit(t),this.url=t.url,!this.url)throw new Error("Source not initialized with required URL")}}class _ extends p{preGetData(t,e,i,s){return[this.params.id_field||"id","position"].forEach((function(t){-1===e.indexOf(t)&&(e.unshift(t),i.unshift(t),s.unshift(null))})),{fields:e,outnames:i,trans:s}}getURL(t,e,i){const s=e.header.analysis||this.params.source||this.params.analysis;if(void 0===s)throw new Error("Association source must specify an analysis ID to plot");return this.url+"results/?filter=analysis in "+s+" and chromosome in  '"+t.chr+"' and position ge "+t.start+" and position le "+t.end}normalizeResponse(t){return t=super.normalizeResponse(t),this.params&&this.params.sort&&t.length&&t[0].position&&t.sort((function(t,e){return t.position-e.position})),t}}class y extends p{constructor(t){super(t),this.__dependentSource=!0}preGetData(t,e){if(e.length>1&&(2!==e.length||-1===e.indexOf("isrefvar")))throw new Error("LD does not know how to get all fields: "+e.join(", "))}findMergeFields(t){let e={id:this.params.id_field,position:this.params.position_field,pvalue:this.params.pvalue_field,_names_:null};if(t&&t.body&&t.body.length>0){const s=Object.keys(t.body[0]),a=(i=s,function(){const t=arguments;for(let e=0;e<t.length;e++){const s=t[e],a=i.filter((function(t){return t.match(s)}));if(a.length)return a[0]}return null}),n=e.id&&a(new RegExp(e.id+"\\b"));e.id=n||a(/\bvariant\b/)||a(/\bid\b/),e.position=e.position||a(/\bposition\b/i,/\bpos\b/i),e.pvalue=e.pvalue||a(/\bpvalue\b/i,/\blog_pvalue\b/i),e._names_=s}var i;return e}findRequestedFields(t,e){let i={};for(let s=0;s<t.length;s++)"isrefvar"===t[s]?(i.isrefvarin=t[s],i.isrefvarout=e&&e[s]):(i.ldin=t[s],i.ldout=e&&e[s]);return i}normalizeResponse(t){return t}getRefvar(t,e,i){let s=this.findRequestedFields(i).ldin;if("state"===s&&(s=t.ldrefvar||e.header.ldrefvar||"best"),"best"===s){if(!e.body)throw new Error("No association data found to find best pvalue");let t=this.findMergeFields(e);if(!t.pvalue||!t.id){let e="";throw t.id||(e+=(e.length?", ":"")+"id"),t.pvalue||(e+=(e.length?", ":"")+"pvalue"),new Error("Unable to find necessary column(s) for merge: "+e+" (available: "+t._names_+")")}s=e.body[function(t,e){let i;i=/log/.test(e=e||"log_pvalue")?function(t,e){return t>e}:function(t,e){return t<e};let s=t[0][e],a=0;for(let n=1;n<t.length;n++)i(t[n][e],s)&&(s=t[n][e],a=n);return a}(e.body,t.pvalue)][t.id]}return s}getURL(t,e,i){const s=t.genome_build||this.params.build||"GRCh37",a=t.ld_source||this.params.source||"1000G",n=t.ld_pop||this.params.population||"ALL",o=this.params.method||"rsquare";c(this.constructor.name,s,null);let r=this.getRefvar(t,e,i);const l=r&&r.match(/^(?:chr)?([a-zA-Z0-9]+?):(\d+)[_:]?(\w+)?[/:|]?([^_]+)?_?(.*)?/);if(!l)throw new Error("Could not request LD for a missing or incomplete marker format");return r=[l[1],":",l[2],"_",l[3],"/",l[4]].join(""),e.header.ldrefvar=r,[this.url,"genome_builds/",s,"/references/",a,"/populations/",n,"/variants","?correlation=",o,"&variant=",encodeURIComponent(r),"&chrom=",encodeURIComponent(t.chr),"&start=",encodeURIComponent(t.start),"&stop=",encodeURIComponent(t.end)].join("")}combineChainBody(t,e,i,s,a){let n=this.findMergeFields(e),o=this.findRequestedFields(i,s);if(!n.position)throw new Error("Unable to find position field for merge: "+n._names_);let r=t.rsquare?"rsquare":"correlation";return function(t,e,i,s){let a=0,o=0;for(;a<t.length&&o<e.position2.length;)t[a][n.position]===e.position2[o]?(t[a][i]=e[s][o],a++,o++):t[a][n.position]<e.position2[o]?a++:o++}(e.body,t,o.ldout,r),o.isrefvarin&&e.header.ldrefvar&&function(t,e,i,s,a){for(let n=0;n<t.length;n++)t[n][i]&&t[n][i]===e?(t[n][s]=1,t[n][a]=1):t[n][s]=0}(e.body,e.header.ldrefvar,n.id,o.isrefvarout,o.ldout),e.body}fetchRequest(t,e,i){let s=this.getURL(t,e,i),a={data:{}},n=function(t){return fetch(t).then().then(t=>{if(!t.ok)throw new Error(t.statusText);return t.text()}).then((function(t){return t=JSON.parse(t),Object.keys(t.data).forEach((function(e){a.data[e]=(a.data[e]||[]).concat(t.data[e])})),t.next?n(t.next):a}))};return n(s)}}class g extends p{constructor(t){super(t),this.__dependentSource=!0}getURL(t,e,i){const s=t.genome_build||this.params.build;c(this.constructor.name,s,null);const a="GRCh38"===s?1:2,n=this.params.source||a;return this.url+"?format=objects&sort=pos&filter=id eq "+n+" and chrom eq '"+t.chr+"' and pos ge "+t.start+" and pos le "+t.end}findMergeFields(t){const e=Object.keys(t).find((function(t){return t.match(/\b(position|pos)\b/i)}));if(!e)throw new Error("Could not find data to align with GWAS catalog results");return{pos:e}}extractFields(t,e,i,s){return t}combineChainBody(t,e,i,s,a){if(!t.length)return e.body;const n=s[i.indexOf("log_pvalue")];function o(t,e,i,s,a){const o=t.n_catalog_matches||0;if(t.n_catalog_matches=o+1,!(t[n]&&t[n]>e.log_pvalue))for(let n=0;n<i.length;n++){const o=i[n],r=s[n];let l=e[o];a&&a[n]&&(l=a[n](l)),t[r]=l}}const r=this.findMergeFields(e.body[0]),l=this.findMergeFields(t[0]);for(var h=0,d=0;h<e.body.length&&d<t.length;){var c=e.body[h],u=t[d];c[r.pos]===u[l.pos]?(o(c,u,i,s,a),d+=1):c[r.pos]<u[l.pos]?h+=1:d+=1}return e.body}}class f extends p{getURL(t,e,i){const s=t.genome_build||this.params.build;let a=this.params.source;return c(this.constructor.name,s,a),s&&(a="GRCh38"===s?1:3),this.url+"?filter=source in "+a+" and chrom eq '"+t.chr+"' and start le "+t.end+" and end ge "+t.start}normalizeResponse(t){return t}extractFields(t,e,i,s){return t}}class m extends p{constructor(t){super(t),this.__dependentSource=!0}getURL(){return this.url}getCacheKey(t,e,i){const s=t.genome_build||this.params.build;return`${this.url} ${t.chr} ${t.start} ${t.end} ${s}`}normalizeResponse(t){return t}fetchRequest(t,e,i){const s=t.genome_build||this.params.build;if(!s)throw new Error(`Data source ${this.constructor.name} must specify a 'genome_build' option`);const a=e.body.reduce((function(t,e){return t[e.gene_name]=null,t}),{});let n=Object.keys(a).map((function(t){return"_"+t.replace(/[^A-Za-z0-9_]/g,"_")+': gene(gene_symbol: "'+t+'", reference_genome: '+s+") { gnomad_constraint { exp_syn obs_syn syn_z oe_syn oe_syn_lower oe_syn_upper exp_mis obs_mis mis_z oe_mis oe_mis_lower oe_mis_upper exp_lof obs_lof pLI oe_lof oe_lof_lower oe_lof_upper } } "}));if(!n.length)return Promise.resolve({data:null});n="{"+n.join(" ")+" }";const o=this.getURL(t,e,i),r=JSON.stringify({query:n});return fetch(o,{method:"POST",body:r,headers:{"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.text()})}combineChainBody(t,e,i,s,a){return t?(e.body.forEach((function(e){const i="_"+e.gene_name.replace(/[^A-Za-z0-9_]/g,"_"),s=t[i]&&t[i].gnomad_constraint;s&&Object.keys(s).forEach((function(t){let i=s[t];void 0===e[t]&&("number"==typeof i&&-1!==i.toString().indexOf(".")&&(i=parseFloat(i.toFixed(2))),e[t]=i)}))})),e.body):e}}class x extends p{getURL(t,e,i){const s=t.genome_build||this.params.build;let a=this.params.source;return c(this.constructor.SOURCE_NAME,s,a),s&&(a="GRCh38"===s?16:15),this.url+"?filter=id in "+a+" and chromosome eq '"+t.chr+"' and position le "+t.end+" and position ge "+t.start}}class b extends u{parseInit(t){this._data=t}getRequest(t,e,i){return Promise.resolve(this._data)}}class v extends p{getURL(t,e,i){const s=(t.genome_build?[t.genome_build]:null)||this.params.build;if(!s||!Array.isArray(s)||!s.length)throw new Error(["Data source",this.constructor.SOURCE_NAME,"requires that you specify array of one or more desired genome build names"].join(" "));return[this.url,"?filter=variant eq '",encodeURIComponent(t.variant),"'&format=objects&",s.map((function(t){return"build="+encodeURIComponent(t)})).join("&")].join("")}}class w extends u{constructor(t){if(super(t),!t||!t.sources)throw new Error("Connectors must specify the data they require as init.sources = {internal_name: chain_source_id}} pairs");this._source_name_mapping=t.sources;const e=Object.keys(t.sources);this.REQUIRED_SOURCES=[],this.REQUIRED_SOURCES.forEach(t=>{if(-1===e.indexOf(t))throw new Error("Configuration for "+this.constructor.name+" must specify a source ID corresponding to "+t)})}parseInit(){}getRequest(t,e,i){return Object.keys(this._source_name_mapping).forEach(t=>{const i=this._source_name_mapping[t];if(e.discrete&&!e.discrete[i])throw new Error(this.constructor.name+" cannot be used before loading required data for: "+i)}),Promise.resolve(e.body||[])}parseResponse(t,e,i,s,a){return Promise.resolve(this.combineChainBody(t,e,i,s,a)).then((function(t){return{header:e.header||{},discrete:e.discrete||{},body:t}}))}combineChainBody(t,e){throw new Error("This method must be implemented in a subclass")}}const z=new d;for(let[t,e]of Object.entries(s))z.add(t,e);z.add("StaticJSON",b),z.add("LDLZ2",y);var k=z,E=i(0),M=i.n(E);class N{constructor(t,e){this.layout=t||{},this.layout.color||(this.layout.color="gray"),this.parent=e||null,this.parent_panel=null,this.parent_plot=null,this.parent_svg=null,this.parent&&("panel"===this.parent.type?(this.parent_panel=this.parent.parent,this.parent_plot=this.parent.parent.parent,this.parent_svg=this.parent_panel):(this.parent_plot=this.parent.parent,this.parent_svg=this.parent_plot)),this.selector=null,this.button=null,this.persist=!1,this.layout.position||(this.layout.position="left")}show(){if(this.parent&&this.parent.selector){if(!this.selector){const t=-1!==["start","middle","end"].indexOf(this.layout.group_position)?" lz-dashboard-group-"+this.layout.group_position:"";this.selector=this.parent.selector.append("div").attr("class","lz-dashboard-"+this.layout.position+t),this.layout.style&&this.selector.style(this.layout.style),"function"==typeof this.initialize&&this.initialize()}return this.button&&"highlighted"===this.button.status&&this.button.menu.show(),this.selector.style({visibility:"visible"}),this.update(),this.position()}}update(){}position(){return this.button&&this.button.menu.position(),this}shouldPersist(){return!!this.persist||!(!this.button||!this.button.persist)}hide(){return!this.selector||this.shouldPersist()||(this.button&&this.button.menu.hide(),this.selector.style({visibility:"hidden"})),this}destroy(t){return void 0===t&&(t=!1),this.selector?(this.shouldPersist()&&!t||(this.button&&this.button.menu&&this.button.menu.destroy(),this.selector.remove(),this.selector=null,this.button=null),this):this}}class S{constructor(t){if(!(t instanceof N))throw new Error("Unable to create dashboard component button, invalid parent");this.parent=t,this.parent_panel=this.parent.parent_panel,this.parent_plot=this.parent.parent_plot,this.parent_svg=this.parent.parent_svg,this.parent_dashboard=this.parent.parent,this.selector=null,this.tag="a",this.html="",this.setHtml=function(t){return void 0!==t&&(this.html=t.toString()),this},this.title="",this.setTitle=function(t){return void 0!==t&&(this.title=t.toString()),this},this.color="gray",this.setColor=function(t){return void 0!==t&&(-1!==["gray","red","orange","yellow","green","blue","purple"].indexOf(t)?this.color=t:this.color="gray"),this},this.style={},this.setStyle=function(t){return void 0!==t&&(this.style=t),this},this.getClass=function(){const t=-1!==["start","middle","end"].indexOf(this.parent.layout.group_position)?" lz-dashboard-button-group-"+this.parent.layout.group_position:"";return"lz-dashboard-button lz-dashboard-button-"+this.color+(this.status?"-"+this.status:"")+t},this.persist=!1,this.permanent=!1,this.setPermanent=function(t){return t=void 0===t||Boolean(t),this.permanent=t,this.permanent&&(this.persist=!0),this},this.shouldPersist=function(){return this.permanent||this.persist},this.status="",this.setStatus=function(t){return void 0!==t&&-1!==["","highlighted","disabled"].indexOf(t)&&(this.status=t),this.update()},this.highlight=function(t){return(t=void 0===t||Boolean(t))?this.setStatus("highlighted"):"highlighted"===this.status?this.setStatus(""):this},this.disable=function(t){return(t=void 0===t||Boolean(t))?this.setStatus("disabled"):"disabled"===this.status?this.setStatus(""):this},this.onmouseover=function(){},this.setOnMouseover=function(t){return this.onmouseover="function"==typeof t?t:function(){},this},this.onmouseout=function(){},this.setOnMouseout=function(t){return this.onmouseout="function"==typeof t?t:function(){},this},this.onclick=function(){},this.setOnclick=function(t){return this.onclick="function"==typeof t?t:function(){},this},this.show=function(){if(this.parent)return this.selector||(this.selector=this.parent.selector.append(this.tag).attr("class",this.getClass())),this.update()},this.preUpdate=function(){return this},this.update=function(){return this.selector?(this.preUpdate(),this.selector.attr("class",this.getClass()).attr("title",this.title).style(this.style).on("mouseover","disabled"===this.status?null:this.onmouseover).on("mouseout","disabled"===this.status?null:this.onmouseout).on("click","disabled"===this.status?null:this.onclick).html(this.html),this.menu.update(),this.postUpdate(),this):this},this.postUpdate=function(){return this},this.hide=function(){return this.selector&&!this.shouldPersist()&&(this.selector.remove(),this.selector=null),this},this.menu={outer_selector:null,inner_selector:null,scroll_position:0,hidden:!0,show:function(){return this.menu.outer_selector||(this.menu.outer_selector=M.a.select(this.parent_plot.svg.node().parentNode).append("div").attr("class","lz-dashboard-menu lz-dashboard-menu-"+this.color).attr("id",this.parent_svg.getBaseId()+".dashboard.menu"),this.menu.inner_selector=this.menu.outer_selector.append("div").attr("class","lz-dashboard-menu-content"),this.menu.inner_selector.on("scroll",function(){this.menu.scroll_position=this.menu.inner_selector.node().scrollTop}.bind(this))),this.menu.outer_selector.style({visibility:"visible"}),this.menu.hidden=!1,this.menu.update()}.bind(this),update:function(){return this.menu.outer_selector?(this.menu.populate(),this.menu.inner_selector&&(this.menu.inner_selector.node().scrollTop=this.menu.scroll_position),this.menu.position()):this.menu}.bind(this),position:function(){if(!this.menu.outer_selector)return this.menu;this.menu.outer_selector.style({height:null});const t=this.parent_svg.getPageOrigin(),e=document.documentElement.scrollTop||document.body.scrollTop,i=this.parent_plot.getContainerOffset(),s=this.parent_dashboard.selector.node().getBoundingClientRect(),a=this.selector.node().getBoundingClientRect(),n=this.menu.outer_selector.node().getBoundingClientRect(),o=this.menu.inner_selector.node().scrollHeight;let r,l;"panel"===this.parent_dashboard.type?(r=t.y+s.height+6,l=Math.max(t.x+this.parent_svg.layout.width-n.width-3,t.x+3)):(r=a.bottom+e+3-i.top,l=Math.max(a.left+a.width-n.width-i.left,t.x+3));const h=Math.max(this.parent_svg.layout.width-6-20,20),d=h,c=h-12,u=Math.max(this.parent_svg.layout.height-30-14,14),p=Math.min(o,u);return this.menu.outer_selector.style({top:r.toString()+"px",left:l.toString()+"px","max-width":d.toString()+"px","max-height":u.toString()+"px",height:p.toString()+"px"}),this.menu.inner_selector.style({"max-width":c.toString()+"px"}),this.menu.inner_selector.node().scrollTop=this.menu.scroll_position,this.menu}.bind(this),hide:function(){return this.menu.outer_selector?(this.menu.outer_selector.style({visibility:"hidden"}),this.menu.hidden=!0,this.menu):this.menu}.bind(this),destroy:function(){return this.menu.outer_selector?(this.menu.inner_selector.remove(),this.menu.outer_selector.remove(),this.menu.inner_selector=null,this.menu.outer_selector=null,this.menu):this.menu}.bind(this),populate:function(){}.bind(this),setPopulate:function(t){return"function"==typeof t?(this.menu.populate=t,this.setOnclick(function(){this.menu.hidden?(this.menu.show(),this.highlight().update(),this.persist=!0):(this.menu.hide(),this.highlight(!1).update(),this.permanent||(this.persist=!1))}.bind(this))):this.setOnclick(),this}.bind(this)}}}var O=class{constructor(t){const e=/^(?:([^:]+):)?([^:|]*)(\|.+)*$/.exec(t);this.full_name=t,this.namespace=e[1]||null,this.name=e[2]||null,this.transformations=[],"string"==typeof e[3]&&e[3].length>1&&(this.transformations=e[3].substring(1).split("|"),this.transformations.forEach(function(t,e){this.transformations[e]=ke.get(t)}.bind(this)))}_applyTransformations(t){return this.transformations.forEach((function(e){t=e(t)})),t}resolve(t,e){if(void 0===t[this.full_name]){let i=null;void 0!==t[this.namespace+":"+this.name]?i=t[this.namespace+":"+this.name]:void 0!==t[this.name]?i=t[this.name]:e&&void 0!==e[this.full_name]&&(i=e[this.full_name]),t[this.full_name]=this._applyTransformations(i)}return t[this.full_name]}};function A(t,e){if("object"!=typeof t||"object"!=typeof e)throw new Error("LocusZoom.Layouts.merge only accepts two layout objects; "+typeof t+", "+typeof e+" given");for(let i in e){if(!Object.prototype.hasOwnProperty.call(e,i))continue;let s=null===t[i]?"undefined":typeof t[i],a=typeof e[i];if("object"===s&&Array.isArray(t[i])&&(s="array"),"object"===a&&Array.isArray(e[i])&&(a="array"),"function"===s||"function"===a)throw new Error("LocusZoom.Layouts.merge encountered an unsupported property type");"undefined"!==s?"object"!==s||"object"!==a||(t[i]=A(t[i],e[i])):t[i]=JSON.parse(JSON.stringify(e[i]))}return t}function T(t){return JSON.parse(JSON.stringify(t))}var L=class{constructor(t){this._sources=t}__split_requests(t){var e={},i=/^(?:([^:]+):)?([^:|]*)(\|.+)*$/;return t.forEach((function(t){var s=i.exec(t),a=s[1]||"base",n=s[2],o=ke.get(s[3]);void 0===e[a]&&(e[a]={outnames:[],fields:[],trans:[]}),e[a].outnames.push(t),e[a].fields.push(n),e[a].trans.push(o)})),e}getData(t,e){for(var i=this.__split_requests(e),s=Object.keys(i).map(e=>{if(!this._sources.get(e))throw new Error("Datasource for namespace "+e+" not found");return this._sources.get(e).getData(t,i[e].fields,i[e].outnames,i[e].trans)}),a=Promise.resolve({header:{},body:[],discrete:{}}),n=0;n<s.length;n++)a=a.then(s[n]);return a}};var D=class{constructor(t){return this.parent=t,this.id=this.parent.getBaseId()+".dashboard",this.type=this.parent.constructor.name.toLowerCase(),this.parent_plot="plot"===this.type?this.parent:this.parent.parent,this.selector=null,this.components=[],this.hide_timeout=null,this.persist=!1,this.initialize()}initialize(){return Array.isArray(this.parent.layout.dashboard.components)&&this.parent.layout.dashboard.components.forEach(function(t){try{const e=ht.create(t.type,t,this);this.components.push(e)}catch(t){console.warn(t)}}.bind(this)),"panel"===this.type&&(M.a.select(this.parent.parent.svg.node().parentNode).on("mouseover."+this.id,function(){clearTimeout(this.hide_timeout),this.selector&&"hidden"!==this.selector.style("visibility")||this.show()}.bind(this)),M.a.select(this.parent.parent.svg.node().parentNode).on("mouseout."+this.id,function(){clearTimeout(this.hide_timeout),this.hide_timeout=setTimeout(function(){this.hide()}.bind(this),300)}.bind(this))),this}shouldPersist(){if(this.persist)return!0;let t=!1;return this.components.forEach((function(e){t=t||e.shouldPersist()})),t=t||this.parent_plot.panel_boundaries.dragging||this.parent_plot.interaction.dragging,!!t}show(){if(!this.selector){switch(this.type){case"plot":this.selector=M.a.select(this.parent.svg.node().parentNode).insert("div",":first-child");break;case"panel":this.selector=M.a.select(this.parent.parent.svg.node().parentNode).insert("div",".lz-data_layer-tooltip, .lz-dashboard-menu, .lz-curtain").classed("lz-panel-dashboard",!0);break;default:throw new Error("Dashboard cannot be a child of "+this.type)}this.selector.classed("lz-dashboard",!0).classed("lz-"+this.type+"-dashboard",!0).attr("id",this.id)}return this.components.forEach((function(t){t.show()})),this.selector.style({visibility:"visible"}),this.update()}update(){return this.selector?(this.components.forEach((function(t){t.update()})),this.position()):this}position(){if(!this.selector)return this;if("panel"===this.type){const t=this.parent.getPageOrigin(),e=(t.y+3.5).toString()+"px",i=t.x.toString()+"px",s=(this.parent.layout.width-4).toString()+"px";this.selector.style({position:"absolute",top:e,left:i,width:s})}return this.components.forEach((function(t){t.position()})),this}hide(){return!this.selector||this.shouldPersist()||(this.components.forEach((function(t){t.hide()})),this.selector.style({visibility:"hidden"})),this}destroy(t){return void 0===t&&(t=!1),this.selector?(this.shouldPersist()&&!t||(this.components.forEach((function(t){t.destroy(!0)})),this.components=[],this.selector.remove(),this.selector=null),this):this}};const P={verbs:["highlight","select","fade","hide"],adjectives:["highlighted","selected","faded","hidden"],menu_antiverbs:["unhighlight","deselect","unfade","show"]};function I(){return{showing:!1,selector:null,content_selector:null,hide_delay:null,show:function(t,e){return this.curtain.showing||(this.curtain.selector=M.a.select(this.parent_plot.svg.node().parentNode).insert("div").attr("class","lz-curtain").attr("id",this.id+".curtain"),this.curtain.content_selector=this.curtain.selector.append("div").attr("class","lz-curtain-content"),this.curtain.selector.append("div").attr("class","lz-curtain-dismiss").html("Dismiss").on("click",function(){this.curtain.hide()}.bind(this)),this.curtain.showing=!0),this.curtain.update(t,e)}.bind(this),update:function(t,e){if(!this.curtain.showing)return this.curtain;clearTimeout(this.curtain.hide_delay),"object"==typeof e&&this.curtain.selector.style(e);const i=this.getPageOrigin();return this.curtain.selector.style({top:i.y+"px",left:i.x+"px",width:this.layout.width+"px",height:this.layout.height+"px"}),this.curtain.content_selector.style({"max-width":this.layout.width-40+"px","max-height":this.layout.height-40+"px"}),"string"==typeof t&&this.curtain.content_selector.html(t),this.curtain}.bind(this),hide:function(t){return this.curtain.showing?"number"==typeof t?(clearTimeout(this.curtain.hide_delay),this.curtain.hide_delay=setTimeout(this.curtain.hide,t),this.curtain):(this.curtain.selector.remove(),this.curtain.selector=null,this.curtain.content_selector=null,this.curtain.showing=!1,this.curtain):this.curtain}.bind(this)}}function R(){return{showing:!1,selector:null,content_selector:null,progress_selector:null,cancel_selector:null,show:function(t){return this.loader.showing||(this.loader.selector=M.a.select(this.parent_plot.svg.node().parentNode).insert("div").attr("class","lz-loader").attr("id",this.id+".loader"),this.loader.content_selector=this.loader.selector.append("div").attr("class","lz-loader-content"),this.loader.progress_selector=this.loader.selector.append("div").attr("class","lz-loader-progress-container").append("div").attr("class","lz-loader-progress"),this.loader.showing=!0,void 0===t&&(t="Loading...")),this.loader.update(t)}.bind(this),update:function(t,e){if(!this.loader.showing)return this.loader;clearTimeout(this.loader.hide_delay),"string"==typeof t&&this.loader.content_selector.html(t);const i=this.getPageOrigin(),s=this.loader.selector.node().getBoundingClientRect();return this.loader.selector.style({top:i.y+this.layout.height-s.height-6+"px",left:i.x+6+"px"}),"number"==typeof e&&this.loader.progress_selector.style({width:Math.min(Math.max(e,1),100)+"%"}),this.loader}.bind(this),animate:function(){return this.loader.progress_selector.classed("lz-loader-progress-animated",!0),this.loader}.bind(this),setPercentCompleted:function(t){return this.loader.progress_selector.classed("lz-loader-progress-animated",!1),this.loader.update(null,t)}.bind(this),hide:function(t){return this.loader.showing?"number"==typeof t?(clearTimeout(this.loader.hide_delay),this.loader.hide_delay=setTimeout(this.loader.hide,t),this.loader):(this.loader.selector.remove(),this.loader.selector=null,this.loader.content_selector=null,this.loader.progress_selector=null,this.loader.cancel_selector=null,this.loader.showing=!1,this.loader):this.loader}.bind(this)}}const j={orientation:"vertical",origin:{x:0,y:0},width:10,height:10,padding:5,label_size:12,hidden:!1};var B=class{constructor(t){return this.parent=t,this.id=this.parent.getBaseId()+".legend",this.parent.layout.legend=A(this.parent.layout.legend||{},j),this.layout=this.parent.layout.legend,this.selector=null,this.background_rect=null,this.elements=[],this.elements_group=null,this.hidden=!1,this.render()}render(){this.selector||(this.selector=this.parent.svg.group.append("g").attr("id",this.parent.getBaseId()+".legend").attr("class","lz-legend")),this.background_rect||(this.background_rect=this.selector.append("rect").attr("width",100).attr("height",100).attr("class","lz-legend-background")),this.elements_group||(this.elements_group=this.selector.append("g")),this.elements.forEach((function(t){t.remove()})),this.elements=[];const t=+this.layout.padding||1;let e=t,i=t,s=0;this.parent.data_layer_ids_by_z_index.slice().reverse().forEach(function(a){Array.isArray(this.parent.data_layers[a].layout.legend)&&this.parent.data_layers[a].layout.legend.forEach(function(a){const n=this.elements_group.append("g").attr("transform","translate("+e+","+i+")"),o=+a.label_size||+this.layout.label_size||12;let r=0,l=o/2+t/2;if(s=Math.max(s,o+t),"line"===a.shape){const e=+a.length||16,i=o/4+t/2;n.append("path").attr("class",a.class||"").attr("d","M0,"+i+"L"+e+","+i).style(a.style||{}),r=e+t}else if("rect"===a.shape){const e=+a.width||16,i=+a.height||e;n.append("rect").attr("class",a.class||"").attr("width",e).attr("height",i).attr("fill",a.color||{}).style(a.style||{}),r=e+t,s=Math.max(s,i+t)}else if(-1!==M.a.svg.symbolTypes.indexOf(a.shape)){const e=+a.size||40,i=Math.ceil(Math.sqrt(e/Math.PI));n.append("path").attr("class",a.class||"").attr("d",M.a.svg.symbol().size(e).type(a.shape)).attr("transform","translate("+i+","+(i+t/2)+")").attr("fill",a.color||{}).style(a.style||{}),r=2*i+t,l=Math.max(2*i+t/2,l),s=Math.max(s,2*i+t)}n.append("text").attr("text-anchor","left").attr("class","lz-label").attr("x",r).attr("y",l).style({"font-size":o}).text(a.label);const h=n.node().getBoundingClientRect();if("vertical"===this.layout.orientation)i+=h.height+t,s=0;else{const a=this.layout.origin.x+e+h.width;e>t&&a>this.parent.layout.width&&(i+=s,e=t,n.attr("transform","translate("+e+","+i+")")),e+=h.width+3*t}this.elements.push(n)}.bind(this))}.bind(this));const a=this.elements_group.node().getBoundingClientRect();return this.layout.width=a.width+2*this.layout.padding,this.layout.height=a.height+2*this.layout.padding,this.background_rect.attr("width",this.layout.width).attr("height",this.layout.height),this.selector.style({visibility:this.layout.hidden?"hidden":"visible"}),this.position()}position(){if(!this.selector)return this;const t=this.selector.node().getBoundingClientRect();isNaN(+this.layout.pad_from_bottom)||(this.layout.origin.y=this.parent.layout.height-t.height-+this.layout.pad_from_bottom),isNaN(+this.layout.pad_from_right)||(this.layout.origin.x=this.parent.layout.width-t.width-+this.layout.pad_from_right),this.selector.attr("transform","translate("+this.layout.origin.x+","+this.layout.origin.y+")")}hide(){this.layout.hidden=!0,this.render()}show(){this.layout.hidden=!1,this.render()}};const C={title:{text:"",style:{},x:10,y:22},y_index:null,width:0,height:0,origin:{x:0,y:null},min_width:1,min_height:1,proportional_width:null,proportional_height:null,proportional_origin:{x:0,y:null},margin:{top:0,right:0,bottom:0,left:0},background_click:"clear_selections",dashboard:{components:[]},cliparea:{height:0,width:0,origin:{x:0,y:0}},axes:{x:{},y1:{},y2:{}},legend:null,interaction:{drag_background_to_pan:!1,drag_x_ticks_to_scale:!1,drag_y1_ticks_to_scale:!1,drag_y2_ticks_to_scale:!1,scroll_to_zoom:!1,x_linked:!1,y1_linked:!1,y2_linked:!1},data_layers:[]};class F{constructor(t,e){if("object"!=typeof t)throw new Error("Unable to create panel, invalid layout");if(this.parent=e||null,this.parent_plot=e,"string"==typeof t.id&&t.id.length){if(this.parent&&void 0!==this.parent.panels[t.id])throw new Error("Cannot create panel with id ["+t.id+"]; panel with that id already exists")}else if(this.parent){const e=()=>{let t="p"+Math.floor(Math.random()*Math.pow(10,8));return null!==t&&void 0===this.parent.panels[t]||(t=e()),t};t.id=e()}else t.id="p"+Math.floor(Math.random()*Math.pow(10,8));this.id=t.id,this.initialized=!1,this.layout_idx=null,this.svg={},this.layout=A(t||{},C),this.parent?(this.state=this.parent.state,this.state_id=this.id,this.state[this.state_id]=this.state[this.state_id]||{}):(this.state=null,this.state_id=null),this.data_layers={},this.data_layer_ids_by_z_index=[],this.data_promises=[],this.x_scale=null,this.y1_scale=null,this.y2_scale=null,this.x_extent=null,this.y1_extent=null,this.y2_extent=null,this.x_ticks=[],this.y1_ticks=[],this.y2_ticks=[],this.zoom_timeout=null,this.event_hooks={layout_changed:[],data_requested:[],data_rendered:[],element_clicked:[],element_selection:[],match_requested:[]},this.initializeLayout()}applyDataLayerZIndexesToDataLayerLayouts(){this.data_layer_ids_by_z_index.forEach((t,e)=>{this.data_layers[t].layout.z_index=e})}getBaseId(){return this.parent.id+"."+this.id}on(t,e){if(!Array.isArray(this.event_hooks[t]))throw new Error("Unable to register event hook, invalid event: "+t.toString());if("function"!=typeof e)throw new Error("Unable to register event hook, invalid hook function passed");return this.event_hooks[t].push(e),e}off(t,e){const i=this.event_hooks[t];if(!Array.isArray(i))throw new Error("Unable to remove event hook, invalid event: "+t.toString());if(void 0===e)this.event_hooks[t]=[];else{const t=i.indexOf(e);if(-1===t)throw new Error("The specified event listener is not registered and therefore cannot be removed");i.splice(t,1)}return this}emit(t,e,i){if(i=i||!1,!Array.isArray(this.event_hooks[t]))throw new Error("LocusZoom attempted to throw an invalid event: "+t.toString());"boolean"==typeof e&&2===arguments.length&&(i=e,e=null);const s={sourceID:this.getBaseId(),data:e||null};return this.event_hooks[t].forEach(t=>{t.call(this,s)}),i&&this.parent&&this.parent.emit(t,s),this}getPageOrigin(){const t=this.parent.getPageOrigin();return{x:t.x+this.layout.origin.x,y:t.y+this.layout.origin.y}}initializeLayout(){if(0===this.layout.width&&null===this.layout.proportional_width&&(this.layout.proportional_width=1),0===this.layout.height&&null===this.layout.proportional_height){const t=Object.keys(this.parent.panels).length;this.layout.proportional_height=t>0?1/t:1}return this.setDimensions(),this.setOrigin(),this.setMargin(),this.x_range=[0,this.layout.cliparea.width],this.y1_range=[this.layout.cliparea.height,0],this.y2_range=[this.layout.cliparea.height,0],["x","y1","y2"].forEach(t=>{Object.keys(this.layout.axes[t]).length&&!1!==this.layout.axes[t].render?(this.layout.axes[t].render=!0,this.layout.axes[t].label=this.layout.axes[t].label||null,this.layout.axes[t].label_function=this.layout.axes[t].label_function||null):this.layout.axes[t].render=!1}),this.layout.data_layers.forEach(t=>{this.addDataLayer(t)}),this}setDimensions(t,e){return void 0!==t&&void 0!==e?!isNaN(t)&&t>=0&&!isNaN(e)&&e>=0&&(this.layout.width=Math.max(Math.round(+t),this.layout.min_width),this.layout.height=Math.max(Math.round(+e),this.layout.min_height)):(null!==this.layout.proportional_width&&(this.layout.width=Math.max(this.layout.proportional_width*this.parent.layout.width,this.layout.min_width)),null!==this.layout.proportional_height&&(this.layout.height=Math.max(this.layout.proportional_height*this.parent.layout.height,this.layout.min_height))),this.layout.cliparea.width=Math.max(this.layout.width-(this.layout.margin.left+this.layout.margin.right),0),this.layout.cliparea.height=Math.max(this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),0),this.svg.clipRect&&this.svg.clipRect.attr("width",this.layout.width).attr("height",this.layout.height),this.initialized&&(this.render(),this.curtain.update(),this.loader.update(),this.dashboard.update(),this.legend&&this.legend.position()),this}setOrigin(t,e){return!isNaN(t)&&t>=0&&(this.layout.origin.x=Math.max(Math.round(+t),0)),!isNaN(e)&&e>=0&&(this.layout.origin.y=Math.max(Math.round(+e),0)),this.initialized&&this.render(),this}setMargin(t,e,i,s){let a;return!isNaN(t)&&t>=0&&(this.layout.margin.top=Math.max(Math.round(+t),0)),!isNaN(e)&&e>=0&&(this.layout.margin.right=Math.max(Math.round(+e),0)),!isNaN(i)&&i>=0&&(this.layout.margin.bottom=Math.max(Math.round(+i),0)),!isNaN(s)&&s>=0&&(this.layout.margin.left=Math.max(Math.round(+s),0)),this.layout.margin.top+this.layout.margin.bottom>this.layout.height&&(a=Math.floor((this.layout.margin.top+this.layout.margin.bottom-this.layout.height)/2),this.layout.margin.top-=a,this.layout.margin.bottom-=a),this.layout.margin.left+this.layout.margin.right>this.layout.width&&(a=Math.floor((this.layout.margin.left+this.layout.margin.right-this.layout.width)/2),this.layout.margin.left-=a,this.layout.margin.right-=a),["top","right","bottom","left"].forEach(t=>{this.layout.margin[t]=Math.max(this.layout.margin[t],0)}),this.layout.cliparea.width=Math.max(this.layout.width-(this.layout.margin.left+this.layout.margin.right),0),this.layout.cliparea.height=Math.max(this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),0),this.layout.cliparea.origin.x=this.layout.margin.left,this.layout.cliparea.origin.y=this.layout.margin.top,this.initialized&&this.render(),this}setTitle(t){if("string"==typeof this.layout.title){const t=this.layout.title;this.layout.title={text:t,x:0,y:0,style:{}}}return"string"==typeof t?this.layout.title.text=t:"object"==typeof t&&null!==t&&(this.layout.title=A(t,this.layout.title)),this.layout.title.text.length?this.title.attr("display",null).attr("x",parseFloat(this.layout.title.x)).attr("y",parseFloat(this.layout.title.y)).style(this.layout.title.style).text(this.layout.title.text):this.title.attr("display","none"),this}initialize(){this.svg.container=this.parent.svg.append("g").attr("id",this.getBaseId()+".panel_container").attr("transform","translate("+(this.layout.origin.x||0)+","+(this.layout.origin.y||0)+")");const t=this.svg.container.append("clipPath").attr("id",this.getBaseId()+".clip");if(this.svg.clipRect=t.append("rect").attr("width",this.layout.width).attr("height",this.layout.height),this.svg.group=this.svg.container.append("g").attr("id",this.getBaseId()+".panel").attr("clip-path","url(#"+this.getBaseId()+".clip)"),this.curtain=I.call(this),this.loader=R.call(this),this.dashboard=new D(this),this.inner_border=this.svg.group.append("rect").attr("class","lz-panel-background").on("click",()=>{"clear_selections"===this.layout.background_click&&this.clearSelections()}),this.title=this.svg.group.append("text").attr("class","lz-panel-title"),void 0!==this.layout.title&&this.setTitle(),this.svg.x_axis=this.svg.group.append("g").attr("id",this.getBaseId()+".x_axis").attr("class","lz-x lz-axis"),this.layout.axes.x.render&&(this.svg.x_axis_label=this.svg.x_axis.append("text").attr("class","lz-x lz-axis lz-label").attr("text-anchor","middle")),this.svg.y1_axis=this.svg.group.append("g").attr("id",this.getBaseId()+".y1_axis").attr("class","lz-y lz-y1 lz-axis"),this.layout.axes.y1.render&&(this.svg.y1_axis_label=this.svg.y1_axis.append("text").attr("class","lz-y1 lz-axis lz-label").attr("text-anchor","middle")),this.svg.y2_axis=this.svg.group.append("g").attr("id",this.getBaseId()+".y2_axis").attr("class","lz-y lz-y2 lz-axis"),this.layout.axes.y2.render&&(this.svg.y2_axis_label=this.svg.y2_axis.append("text").attr("class","lz-y2 lz-axis lz-label").attr("text-anchor","middle")),this.data_layer_ids_by_z_index.forEach(t=>{this.data_layers[t].initialize()}),this.legend=null,this.layout.legend&&(this.legend=new B(this)),this.layout.interaction.drag_background_to_pan){const t="."+this.parent.id+"."+this.id+".interaction.drag",e=()=>{this.parent.startDrag(this,"background")};this.svg.container.select(".lz-panel-background").on("mousedown"+t+".background",e).on("touchstart"+t+".background",e)}return this}resortDataLayers(){const t=[];this.data_layer_ids_by_z_index.forEach(e=>{t.push(this.data_layers[e].layout.z_index)}),this.svg.group.selectAll("g.lz-data_layer-container").data(t).sort(M.a.ascending),this.applyDataLayerZIndexesToDataLayerLayouts()}getLinkedPanelIds(t){const e=[];return-1===["x","y1","y2"].indexOf(t=t||null)?e:this.layout.interaction[t+"_linked"]?(this.parent.panel_ids_by_y_index.forEach(i=>{i!==this.id&&this.parent.panels[i].layout.interaction[t+"_linked"]&&e.push(i)}),e):e}moveUp(){return this.parent.panel_ids_by_y_index[this.layout.y_index-1]&&(this.parent.panel_ids_by_y_index[this.layout.y_index]=this.parent.panel_ids_by_y_index[this.layout.y_index-1],this.parent.panel_ids_by_y_index[this.layout.y_index-1]=this.id,this.parent.applyPanelYIndexesToPanelLayouts(),this.parent.positionPanels()),this}moveDown(){return this.parent.panel_ids_by_y_index[this.layout.y_index+1]&&(this.parent.panel_ids_by_y_index[this.layout.y_index]=this.parent.panel_ids_by_y_index[this.layout.y_index+1],this.parent.panel_ids_by_y_index[this.layout.y_index+1]=this.id,this.parent.applyPanelYIndexesToPanelLayouts(),this.parent.positionPanels()),this}addDataLayer(t){if("object"!=typeof t||"string"!=typeof t.id||!t.id.length)throw new Error("Invalid data layer layout passed to addDataLayer()");if(void 0!==this.data_layers[t.id])throw new Error("Cannot create data_layer with id ["+t.id+"]; data layer with that id already exists in the panel");if("string"!=typeof t.type)throw new Error("Invalid data layer type in layout passed to addDataLayer()");"object"!=typeof t.y_axis||void 0!==t.y_axis.axis&&-1!==[1,2].indexOf(t.y_axis.axis)||(t.y_axis.axis=1);const e=At.create(t.type,t,this);if(this.data_layers[e.id]=e,null!==e.layout.z_index&&!isNaN(e.layout.z_index)&&this.data_layer_ids_by_z_index.length>0)e.layout.z_index<0&&(e.layout.z_index=Math.max(this.data_layer_ids_by_z_index.length+e.layout.z_index,0)),this.data_layer_ids_by_z_index.splice(e.layout.z_index,0,e.id),this.data_layer_ids_by_z_index.forEach((t,e)=>{this.data_layers[t].layout.z_index=e});else{const t=this.data_layer_ids_by_z_index.push(e.id);this.data_layers[e.id].layout.z_index=t-1}let i=null;return this.layout.data_layers.forEach((t,s)=>{t.id===e.id&&(i=s)}),null===i&&(i=this.layout.data_layers.push(this.data_layers[e.id].layout)-1),this.data_layers[e.id].layout_idx=i,this.data_layers[e.id]}removeDataLayer(t){if(!this.data_layers[t])throw new Error("Unable to remove data layer, ID not found: "+t);return this.data_layers[t].destroyAllTooltips(),this.data_layers[t].svg.container&&this.data_layers[t].svg.container.remove(),this.layout.data_layers.splice(this.data_layers[t].layout_idx,1),delete this.state[this.data_layers[t].state_id],delete this.data_layers[t],this.data_layer_ids_by_z_index.splice(this.data_layer_ids_by_z_index.indexOf(t),1),this.applyDataLayerZIndexesToDataLayerLayouts(),this.layout.data_layers.forEach((t,e)=>{this.data_layers[t.id].layout_idx=e}),this}clearSelections(){return this.data_layer_ids_by_z_index.forEach(t=>{this.data_layers[t].setAllElementStatus("selected",!1)}),this}reMap(){this.emit("data_requested"),this.data_promises=[],this.curtain.hide();for(let t in this.data_layers)try{this.data_promises.push(this.data_layers[t].reMap())}catch(t){console.error(t),this.curtain.show(t.message||t)}return Promise.all(this.data_promises).then(()=>{this.initialized=!0,this.render(),this.emit("layout_changed",!0),this.emit("data_rendered")}).catch(t=>{console.error(t),this.curtain.show(t.message||t)})}generateExtents(){["x","y1","y2"].forEach(t=>{this[t+"_extent"]=null});for(let t in this.data_layers){const e=this.data_layers[t];if(e.layout.x_axis&&!e.layout.x_axis.decoupled&&(this.x_extent=M.a.extent((this.x_extent||[]).concat(e.getAxisExtent("x")))),e.layout.y_axis&&!e.layout.y_axis.decoupled){const t="y"+e.layout.y_axis.axis;this[t+"_extent"]=M.a.extent((this[t+"_extent"]||[]).concat(e.getAxisExtent("y")))}}return this.layout.axes.x&&"state"===this.layout.axes.x.extent&&(this.x_extent=[this.state.start,this.state.end]),this}generateTicks(t){if(this.layout.axes[t].ticks){const e=this.layout.axes[t].ticks;if(Array.isArray(e))return e;if("object"==typeof e){const i=this,s={position:e.position};return this.data_layer_ids_by_z_index.reduce((e,a)=>{const n=i.data_layers[a];return e.concat(n.getTicks(t,s))},[]).map(t=>{let i={};return i=A(i,e),A(i,t)})}}return this[t+"_extent"]?function(t,e,i){(void 0===i||isNaN(parseInt(i)))&&(i=5);const s=(i=+i)/3,a=Math.abs(t[0]-t[1]);let n=a/i;Math.log(a)/Math.LN10<-2&&(n=.75*Math.max(Math.abs(a))/s);const o=Math.pow(10,Math.floor(Math.log(n)/Math.LN10));let r=0;o<1&&0!==o&&(r=Math.abs(Math.round(Math.log(o)/Math.LN10)));let l=o;2*o-n<1.5*(n-l)&&(l=2*o,5*o-n<2.75*(n-l)&&(l=5*o,10*o-n<1.5*(n-l)&&(l=10*o)));let h=[],d=parseFloat((Math.floor(t[0]/l)*l).toFixed(r));for(;d<t[1];)h.push(d),d+=l,r>0&&(d=parseFloat(d.toFixed(r)));h.push(d),(void 0===e||-1===["low","high","both","neither"].indexOf(e))&&(e="neither");"low"!==e&&"both"!==e||h[0]<t[0]&&(h=h.slice(1));"high"!==e&&"both"!==e||h[h.length-1]>t[1]&&h.pop();return h}(this[t+"_extent"],"both"):[]}render(){this.svg.container.attr("transform","translate("+this.layout.origin.x+","+this.layout.origin.y+")"),this.svg.clipRect.attr("width",this.layout.width).attr("height",this.layout.height),this.inner_border.attr("x",this.layout.margin.left).attr("y",this.layout.margin.top).attr("width",this.layout.width-(this.layout.margin.left+this.layout.margin.right)).attr("height",this.layout.height-(this.layout.margin.top+this.layout.margin.bottom)),this.layout.inner_border&&this.inner_border.style({"stroke-width":1,stroke:this.layout.inner_border}),this.setTitle(),this.generateExtents();const t=function(t,e){const i=Math.pow(-10,e),s=Math.pow(-10,-e),a=Math.pow(10,-e),n=Math.pow(10,e);return t===1/0&&(t=n),t===-1/0&&(t=i),0===t&&(t=a),t>0&&(t=Math.max(Math.min(t,n),a)),t<0&&(t=Math.max(Math.min(t,s),i)),t},e={};if(this.x_extent){const t={start:0,end:this.layout.cliparea.width};this.layout.axes.x.range&&(t.start=this.layout.axes.x.range.start||t.start,t.end=this.layout.axes.x.range.end||t.end),e.x=[t.start,t.end],e.x_shifted=[t.start,t.end]}if(this.y1_extent){const t={start:this.layout.cliparea.height,end:0};this.layout.axes.y1.range&&(t.start=this.layout.axes.y1.range.start||t.start,t.end=this.layout.axes.y1.range.end||t.end),e.y1=[t.start,t.end],e.y1_shifted=[t.start,t.end]}if(this.y2_extent){const t={start:this.layout.cliparea.height,end:0};this.layout.axes.y2.range&&(t.start=this.layout.axes.y2.range.start||t.start,t.end=this.layout.axes.y2.range.end||t.end),e.y2=[t.start,t.end],e.y2_shifted=[t.start,t.end]}if(this.parent.interaction.panel_id&&(this.parent.interaction.panel_id===this.id||-1!==this.parent.interaction.linked_panel_ids.indexOf(this.id))){let i,s=null;if(this.parent.interaction.zooming&&"function"==typeof this.x_scale){const t=Math.abs(this.x_extent[1]-this.x_extent[0]),s=Math.round(this.x_scale.invert(e.x_shifted[1]))-Math.round(this.x_scale.invert(e.x_shifted[0]));let a=this.parent.interaction.zooming.scale;const n=Math.floor(s*(1/a));a<1&&!isNaN(this.parent.layout.max_region_scale)?a=1/(Math.min(n,this.parent.layout.max_region_scale)/s):a>1&&!isNaN(this.parent.layout.min_region_scale)&&(a=1/(Math.max(n,this.parent.layout.min_region_scale)/s));const o=Math.floor(t*a);i=this.parent.interaction.zooming.center-this.layout.margin.left-this.layout.origin.x;const r=i/this.layout.cliparea.width,l=Math.max(Math.floor(this.x_scale.invert(e.x_shifted[0])-(o-s)*r),1);e.x_shifted=[this.x_scale(l),this.x_scale(l+o)]}else if(this.parent.interaction.dragging)switch(this.parent.interaction.dragging.method){case"background":e.x_shifted[0]=+this.parent.interaction.dragging.dragged_x,e.x_shifted[1]=this.layout.cliparea.width+this.parent.interaction.dragging.dragged_x;break;case"x_tick":M.a.event&&M.a.event.shiftKey?(e.x_shifted[0]=+this.parent.interaction.dragging.dragged_x,e.x_shifted[1]=this.layout.cliparea.width+this.parent.interaction.dragging.dragged_x):(i=this.parent.interaction.dragging.start_x-this.layout.margin.left-this.layout.origin.x,s=t(i/(i+this.parent.interaction.dragging.dragged_x),3),e.x_shifted[0]=0,e.x_shifted[1]=Math.max(this.layout.cliparea.width*(1/s),1));break;case"y1_tick":case"y2_tick":{const a="y"+this.parent.interaction.dragging.method[1]+"_shifted";M.a.event&&M.a.event.shiftKey?(e[a][0]=this.layout.cliparea.height+this.parent.interaction.dragging.dragged_y,e[a][1]=+this.parent.interaction.dragging.dragged_y):(i=this.layout.cliparea.height-(this.parent.interaction.dragging.start_y-this.layout.margin.top-this.layout.origin.y),s=t(i/(i-this.parent.interaction.dragging.dragged_y),3),e[a][0]=this.layout.cliparea.height,e[a][1]=this.layout.cliparea.height-this.layout.cliparea.height*(1/s))}}}if(["x","y1","y2"].forEach(t=>{this[t+"_extent"]&&(this[t+"_scale"]=M.a.scale.linear().domain(this[t+"_extent"]).range(e[t+"_shifted"]),this[t+"_extent"]=[this[t+"_scale"].invert(e[t][0]),this[t+"_scale"].invert(e[t][1])],this[t+"_scale"]=M.a.scale.linear().domain(this[t+"_extent"]).range(e[t]),this.renderAxis(t))}),this.layout.interaction.scroll_to_zoom){const t=()=>{if(!M.a.event.shiftKey)return void(this.parent.canInteract(this.id)&&this.loader.show("Press <tt>[SHIFT]</tt> while scrolling to zoom").hide(1e3));if(M.a.event.preventDefault(),!this.parent.canInteract(this.id))return;const t=M.a.mouse(this.svg.container.node()),e=Math.max(-1,Math.min(1,M.a.event.wheelDelta||-M.a.event.detail||-M.a.event.deltaY));0!==e&&(this.parent.interaction={panel_id:this.id,linked_panel_ids:this.getLinkedPanelIds("x"),zooming:{scale:e<1?.9:1.1,center:t[0]}},this.render(),this.parent.interaction.linked_panel_ids.forEach(t=>{this.parent.panels[t].render()}),null!==this.zoom_timeout&&clearTimeout(this.zoom_timeout),this.zoom_timeout=setTimeout(()=>{this.parent.interaction={},this.parent.applyState({start:this.x_extent[0],end:this.x_extent[1]})},500))};this.zoom_listener=M.a.behavior.zoom(),this.svg.container.call(this.zoom_listener).on("wheel.zoom",t).on("mousewheel.zoom",t).on("DOMMouseScroll.zoom",t)}return this.data_layer_ids_by_z_index.forEach(t=>{this.data_layers[t].draw().render()}),this}renderAxis(t){if(-1===["x","y1","y2"].indexOf(t))throw new Error("Unable to render axis; invalid axis identifier: "+t);const e=this.layout.axes[t].render&&"function"==typeof this[t+"_scale"]&&!isNaN(this[t+"_scale"](0));if(this[t+"_axis"]&&this.svg.container.select("g.lz-axis.lz-"+t).style("display",e?null:"none"),!e)return this;const i={x:{position:"translate("+this.layout.margin.left+","+(this.layout.height-this.layout.margin.bottom)+")",orientation:"bottom",label_x:this.layout.cliparea.width/2,label_y:this.layout.axes[t].label_offset||0,label_rotate:null},y1:{position:"translate("+this.layout.margin.left+","+this.layout.margin.top+")",orientation:"left",label_x:-1*(this.layout.axes[t].label_offset||0),label_y:this.layout.cliparea.height/2,label_rotate:-90},y2:{position:"translate("+(this.layout.width-this.layout.margin.right)+","+this.layout.margin.top+")",orientation:"right",label_x:this.layout.axes[t].label_offset||0,label_y:this.layout.cliparea.height/2,label_rotate:-90}};this[t+"_ticks"]=this.generateTicks(t);const s=(t=>{for(let e=0;e<t.length;e++)if(isNaN(t[e]))return!1;return!0})(this[t+"_ticks"]);if(this[t+"_axis"]=M.a.svg.axis().scale(this[t+"_scale"]).orient(i[t].orientation).tickPadding(3),s)this[t+"_axis"].tickValues(this[t+"_ticks"]),"region"===this.layout.axes[t].tick_format&&this[t+"_axis"].tickFormat(t=>H(t,6));else{let e=this[t+"_ticks"].map(e=>e[t.substr(0,1)]);this[t+"_axis"].tickValues(e).tickFormat((e,i)=>this[t+"_ticks"][i].text)}if(this.svg[t+"_axis"].attr("transform",i[t].position).call(this[t+"_axis"]),!s){const e=M.a.selectAll("g#"+this.getBaseId().replace(".","\\.")+"\\."+t+"_axis g.tick"),i=this;e.each((e,s)=>{const a=M.a.select(this).select("text");i[t+"_ticks"][s].style&&a.style(i[t+"_ticks"][s].style),i[t+"_ticks"][s].transform&&a.attr("transform",i[t+"_ticks"][s].transform)})}const a=this.layout.axes[t].label||null;return null!==a&&(this.svg[t+"_axis_label"].attr("x",i[t].label_x).attr("y",i[t].label_y).text(J(this.state,a)),null!==i[t].label_rotate&&this.svg[t+"_axis_label"].attr("transform","rotate("+i[t].label_rotate+" "+i[t].label_x+","+i[t].label_y+")")),["x","y1","y2"].forEach(t=>{if(this.layout.interaction["drag_"+t+"_ticks_to_scale"]){const e="."+this.parent.id+"."+this.id+".interaction.drag",i=()=>{"function"==typeof M.a.select(this).node().focus&&M.a.select(this).node().focus();let s="x"===t?"ew-resize":"ns-resize";M.a.event&&M.a.event.shiftKey&&(s="move"),M.a.select(this).style({"font-weight":"bold",cursor:s}).on("keydown"+e,i).on("keyup"+e,i)};this.svg.container.selectAll(".lz-axis.lz-"+t+" .tick text").attr("tabindex",0).on("mouseover"+e,i).on("mouseout"+e,(function(){M.a.select(this).style({"font-weight":"normal"}),M.a.select(this).on("keydown"+e,null).on("keyup"+e,null)})).on("mousedown"+e,()=>{this.parent.startDrag(this,t+"_tick")})}}),this}scaleHeightToData(t){null===(t=+t||null)&&this.data_layer_ids_by_z_index.forEach(e=>{const i=this.data_layers[e].getAbsoluteDataHeight();+i&&(t=null===t?+i:Math.max(t,+i))}),+t&&(t+=+this.layout.margin.top+ +this.layout.margin.bottom,this.setDimensions(this.layout.width,t),this.parent.setDimensions(),this.parent.panel_ids_by_y_index.forEach(t=>{this.parent.panels[t].layout.proportional_height=null}),this.parent.positionPanels())}setElementStatusByFilters(t,e,i,s){this.data_layer_ids_by_z_index.forEach(a=>{this.data_layers[a].setElementStatusByFilters(t,e,i,s)})}setAllElementStatus(t,e){this.data_layer_ids_by_z_index.forEach(i=>{this.data_layers[i].setAllElementStatus(t,e)})}addBasicLoader(t){return void 0!==t&&(t=!0),t&&this.loader.show("Loading...").animate(),this.on("data_requested",()=>{this.loader.show("Loading...").animate()}),this.on("data_rendered",()=>{this.loader.hide()}),this}}P.verbs.forEach((t,e)=>{const i=P.adjectives[e],s="un"+t;F.prototype[t+"ElementsByFilters"]=function(t,e){return e=void 0!==e&&!!e,this.setElementStatusByFilters(i,!0,t,e)},F.prototype[s+"ElementsByFilters"]=function(t,e){return e=void 0!==e&&!!e,this.setElementStatusByFilters(i,!1,t,e)},F.prototype[t+"AllElements"]=function(){return this.setAllElementStatus(i,!0),this},F.prototype[s+"AllElements"]=function(){return this.setAllElementStatus(i,!1),this}});var U=F;const q={state:{},width:1,height:1,min_width:1,min_height:1,responsive_resize:!1,aspect_ratio:1,panels:[],dashboard:{components:[]},panel_boundaries:!0,mouse_guide:!0};var Z=class{constructor(t,e,i){this.initialized=!1,this.parent_plot=this,this.id=t,this.container=null,this.svg=null,this.panels={},this.panel_ids_by_y_index=[],this.remap_promises=[],this.layout=i,A(this.layout,q),this._base_layout=JSON.parse(JSON.stringify(this.layout)),this.state=this.layout.state,this.lzd=new L(e),this.window_onresize=null,this.event_hooks={layout_changed:[],data_requested:[],data_rendered:[],element_clicked:[],element_selection:[],match_requested:[],panel_removed:[],state_changed:[]},this.interaction={},this.initializeLayout()}on(t,e){if(!Array.isArray(this.event_hooks[t]))throw new Error("Unable to register event hook, invalid event: "+t.toString());if("function"!=typeof e)throw new Error("Unable to register event hook, invalid hook function passed");return this.event_hooks[t].push(e),e}off(t,e){const i=this.event_hooks[t];if(!Array.isArray(i))throw new Error("Unable to remove event hook, invalid event: "+t.toString());if(void 0===e)this.event_hooks[t]=[];else{const t=i.indexOf(e);if(-1===t)throw new Error("The specified event listener is not registered and therefore cannot be removed");i.splice(t,1)}return this}emit(t,e){if(!Array.isArray(this.event_hooks[t]))throw new Error("LocusZoom attempted to throw an invalid event: "+t.toString());const i=this.getBaseId(),s=this;return this.event_hooks[t].forEach((function(t){let a;a=e&&e.sourceID?e:{sourceID:i,data:e||null},t.call(s,a)})),this}canInteract(t){return(t=t||null)?(void 0===this.interaction.panel_id||this.interaction.panel_id===t)&&!this.loading_data:!(this.interaction.dragging||this.interaction.zooming||this.loading_data)}getPageOrigin(){const t=this.svg.node().getBoundingClientRect();let e=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop,s=this.svg.node();for(;null!==s.parentNode;)if(s=s.parentNode,s!==document&&"static"!==M.a.select(s).style("position")){e=-1*s.getBoundingClientRect().left,i=-1*s.getBoundingClientRect().top;break}return{x:e+t.left,y:i+t.top,width:t.width,height:t.height}}getContainerOffset(){const t={top:0,left:0};let e=this.container.offsetParent||null;for(;null!==e;)t.top+=e.offsetTop,t.left+=e.offsetLeft,e=e.offsetParent||null;return t}applyPanelYIndexesToPanelLayouts(){this.panel_ids_by_y_index.forEach(function(t,e){this.panels[t].layout.y_index=e}.bind(this))}getBaseId(){return this.id}sumProportional(t){if("height"!==t&&"width"!==t)throw new Error("Bad dimension value passed to sumProportional");let e=0;for(let i in this.panels)this.panels[i].layout["proportional_"+t]||(this.panels[i].layout["proportional_"+t]=1/Object.keys(this.panels).length),e+=this.panels[i].layout["proportional_"+t];return e}rescaleSVG(){const t=this.svg.node().getBoundingClientRect();return this.setDimensions(t.width,t.height),this}initializeLayout(){if(isNaN(this.layout.width)||this.layout.width<=0)throw new Error("Plot layout parameter `width` must be a positive number");if(isNaN(this.layout.height)||this.layout.height<=0)throw new Error("Plot layout parameter `width` must be a positive number");if(isNaN(this.layout.aspect_ratio)||this.layout.aspect_ratio<=0)throw new Error("Plot layout parameter `aspect_ratio` must be a positive number");!0===this.layout.responsive_resize&&(console.warn('LocusZoom "responsive_resize" specifies a deprecated value. The new value should be "both". Please update your layout.'),this.layout.responsive_resize="both");const t=[!1,"both","width_only"];if(-1===t.indexOf(this.layout.responsive_resize))throw new Error('LocusZoom option "responsive_resize" should specify one of the following modes: '+t.join(", "));return this.layout.responsive_resize&&(this.window_onresize=M.a.select(window).on("resize.lz-"+this.id,function(){this.rescaleSVG()}.bind(this)),M.a.select(window).on("load.lz-"+this.id,function(){this.setDimensions()}.bind(this))),this.layout.panels.forEach(function(t){this.addPanel(t)}.bind(this)),this}setDimensions(t,e){let i,s=parseFloat(this.layout.min_width)||0,a=parseFloat(this.layout.min_height)||0;for(i in this.panels)s=Math.max(s,this.panels[i].layout.min_width),parseFloat(this.panels[i].layout.min_height)>0&&parseFloat(this.panels[i].layout.proportional_height)>0&&(a=Math.max(a,this.panels[i].layout.min_height/this.panels[i].layout.proportional_height));if(this.layout.min_width=Math.max(s,1),this.layout.min_height=Math.max(a,1),M.a.select(this.svg.node().parentNode).style({"min-width":this.layout.min_width+"px","min-height":this.layout.min_height+"px"}),!isNaN(t)&&t>=0&&!isNaN(e)&&e>=0){this.layout.width=Math.max(Math.round(+t),this.layout.min_width),this.layout.height=Math.max(Math.round(+e),this.layout.min_height),this.layout.aspect_ratio=this.layout.width/this.layout.height,this.layout.responsive_resize&&(this.svg&&(this.layout.width=Math.max(this.svg.node().parentNode.getBoundingClientRect().width,this.layout.min_width)),"both"===this.layout.responsive_resize&&(this.layout.height=this.layout.width/this.layout.aspect_ratio,this.layout.height<this.layout.min_height&&(this.layout.height=this.layout.min_height,this.layout.width=this.layout.height*this.layout.aspect_ratio)));let i=0;this.panel_ids_by_y_index.forEach(function(t){const e=this.layout.width,s=this.panels[t].layout.proportional_height*this.layout.height;this.panels[t].setDimensions(e,s),this.panels[t].setOrigin(0,i),this.panels[t].layout.proportional_origin.x=0,this.panels[t].layout.proportional_origin.y=i/this.layout.height,i+=s,this.panels[t].dashboard.update()}.bind(this))}else if(Object.keys(this.panels).length){for(i in this.layout.width=0,this.layout.height=0,this.panels)this.layout.width=Math.max(this.panels[i].layout.width,this.layout.width),this.layout.height+=this.panels[i].layout.height;this.layout.width=Math.max(this.layout.width,this.layout.min_width),this.layout.height=Math.max(this.layout.height,this.layout.min_height)}return this.layout.aspect_ratio=this.layout.width/this.layout.height,null!==this.svg&&("both"===this.layout.responsive_resize?this.svg.attr("viewBox","0 0 "+this.layout.width+" "+this.layout.height).attr("preserveAspectRatio","xMinYMin meet"):this.svg.attr("width",this.layout.width).attr("height",this.layout.height)),this.initialized&&(this.panel_boundaries.position(),this.dashboard.update(),this.curtain.update(),this.loader.update()),this.emit("layout_changed")}addPanel(t){if("object"!=typeof t)throw new Error("Invalid panel layout passed to addPanel()");const e=new U(t,this);if(this.panels[e.id]=e,null!==e.layout.y_index&&!isNaN(e.layout.y_index)&&this.panel_ids_by_y_index.length>0)e.layout.y_index<0&&(e.layout.y_index=Math.max(this.panel_ids_by_y_index.length+e.layout.y_index,0)),this.panel_ids_by_y_index.splice(e.layout.y_index,0,e.id),this.applyPanelYIndexesToPanelLayouts();else{const t=this.panel_ids_by_y_index.push(e.id);this.panels[e.id].layout.y_index=t-1}let i=null;return this.layout.panels.forEach((function(t,s){t.id===e.id&&(i=s)})),null===i&&(i=this.layout.panels.push(this.panels[e.id].layout)-1),this.panels[e.id].layout_idx=i,this.initialized&&(this.positionPanels(),this.panels[e.id].initialize(),this.panels[e.id].reMap(),this.setDimensions(this.layout.width,this.layout.height)),this.panels[e.id]}clearPanelData(t,e){let i;e=e||"wipe",i=t?[t]:Object.keys(this.panels);const s=this;return i.forEach((function(t){s.panels[t].data_layer_ids_by_z_index.forEach((function(i){const a=s.panels[t].data_layers[i];a.destroyAllTooltips(),delete a.layer_state,delete s.layout.state[a.state_id],"reset"===e&&a._setDefaultState()}))})),this}removePanel(t){if(!this.panels[t])throw new Error("Unable to remove panel, ID not found: "+t);return this.panel_boundaries.hide(),this.clearPanelData(t),this.panels[t].loader.hide(),this.panels[t].dashboard.destroy(!0),this.panels[t].curtain.hide(),this.panels[t].svg.container&&this.panels[t].svg.container.remove(),this.layout.panels.splice(this.panels[t].layout_idx,1),delete this.panels[t],delete this.layout.state[t],this.layout.panels.forEach(function(t,e){this.panels[t.id].layout_idx=e}.bind(this)),this.panel_ids_by_y_index.splice(this.panel_ids_by_y_index.indexOf(t),1),this.applyPanelYIndexesToPanelLayouts(),this.initialized&&(this.layout.min_height=this._base_layout.min_height,this.layout.min_width=this._base_layout.min_width,this.positionPanels(),this.setDimensions(this.layout.width,this.layout.height)),this.emit("panel_removed",t),this}positionPanels(){let t;const e={left:0,right:0};for(t in this.panels)null===this.panels[t].layout.proportional_height&&(this.panels[t].layout.proportional_height=this.panels[t].layout.height/this.layout.height),null===this.panels[t].layout.proportional_width&&(this.panels[t].layout.proportional_width=1),this.panels[t].layout.interaction.x_linked&&(e.left=Math.max(e.left,this.panels[t].layout.margin.left),e.right=Math.max(e.right,this.panels[t].layout.margin.right));const i=this.sumProportional("height");if(!i)return this;const s=1/i;for(t in this.panels)this.panels[t].layout.proportional_height*=s;let a=0;this.panel_ids_by_y_index.forEach(function(t){if(this.panels[t].setOrigin(0,a),this.panels[t].layout.proportional_origin.x=0,a+=this.panels[t].layout.height,this.panels[t].layout.interaction.x_linked){const i=Math.max(e.left-this.panels[t].layout.margin.left,0)+Math.max(e.right-this.panels[t].layout.margin.right,0);this.panels[t].layout.width+=i,this.panels[t].layout.margin.left=e.left,this.panels[t].layout.margin.right=e.right,this.panels[t].layout.cliparea.origin.x=e.left}}.bind(this));const n=a;return this.panel_ids_by_y_index.forEach(function(t){this.panels[t].layout.proportional_origin.y=this.panels[t].layout.origin.y/n}.bind(this)),this.setDimensions(),this.panel_ids_by_y_index.forEach(function(t){this.panels[t].setDimensions(this.layout.width*this.panels[t].layout.proportional_width,this.layout.height*this.panels[t].layout.proportional_height)}.bind(this)),this}initialize(){if(this.layout.responsive_resize&&M.a.select(this.container).classed("lz-container-responsive",!0),this.layout.mouse_guide){const t=this.svg.append("g").attr("class","lz-mouse_guide").attr("id",this.id+".mouse_guide"),e=t.append("rect").attr("class","lz-mouse_guide-vertical").attr("x",-1),i=t.append("rect").attr("class","lz-mouse_guide-horizontal").attr("y",-1);this.mouse_guide={svg:t,vertical:e,horizontal:i}}this.curtain=I.call(this),this.loader=R.call(this),this.panel_boundaries={parent:this,hide_timeout:null,showing:!1,dragging:!1,selectors:[],corner_selector:null,show:function(){if(!this.showing&&!this.parent.curtain.showing){this.showing=!0,this.parent.panel_ids_by_y_index.forEach((t,e)=>{const i=M.a.select(this.parent.svg.node().parentNode).insert("div",".lz-data_layer-tooltip").attr("class","lz-panel-boundary").attr("title","Resize panel");i.append("span");const s=M.a.behavior.drag();s.on("dragstart",()=>{this.dragging=!0}),s.on("dragend",()=>{this.dragging=!1}),s.on("drag",()=>{const t=this.parent.panels[this.parent.panel_ids_by_y_index[e]],i=t.layout.height;t.setDimensions(t.layout.width,t.layout.height+M.a.event.dy);const s=t.layout.height-i,a=this.parent.layout.height+s;this.parent.panel_ids_by_y_index.forEach((t,i)=>{const n=this.parent.panels[this.parent.panel_ids_by_y_index[i]];n.layout.proportional_height=n.layout.height/a,i>e&&(n.setOrigin(n.layout.origin.x,n.layout.origin.y+s),n.dashboard.position())}),this.parent.positionPanels(),this.position()}),i.call(s),this.parent.panel_boundaries.selectors.push(i)});const t=M.a.select(this.parent.svg.node().parentNode).insert("div",".lz-data_layer-tooltip").attr("class","lz-panel-corner-boundary").attr("title","Resize plot");t.append("span").attr("class","lz-panel-corner-boundary-outer"),t.append("span").attr("class","lz-panel-corner-boundary-inner");const e=M.a.behavior.drag();e.on("dragstart",()=>{this.dragging=!0}),e.on("dragend",()=>{this.dragging=!1}),e.on("drag",function(){this.setDimensions(this.layout.width+M.a.event.dx,this.layout.height+M.a.event.dy)}.bind(this.parent)),t.call(e),this.parent.panel_boundaries.corner_selector=t}return this.position()},position:function(){if(!this.showing)return this;const t=this.parent.getPageOrigin();this.selectors.forEach(function(e,i){const s=this.parent.panels[this.parent.panel_ids_by_y_index[i]].getPageOrigin(),a=t.x,n=s.y+this.parent.panels[this.parent.panel_ids_by_y_index[i]].layout.height-12,o=this.parent.layout.width-1;e.style({top:n+"px",left:a+"px",width:o+"px"}),e.select("span").style({width:o+"px"})}.bind(this));return this.corner_selector.style({top:t.y+this.parent.layout.height-10-16+"px",left:t.x+this.parent.layout.width-10-16+"px"}),this},hide:function(){return this.showing?(this.showing=!1,this.selectors.forEach((function(t){t.remove()})),this.selectors=[],this.corner_selector.remove(),this.corner_selector=null,this):this}},this.layout.panel_boundaries&&(M.a.select(this.svg.node().parentNode).on("mouseover."+this.id+".panel_boundaries",function(){clearTimeout(this.panel_boundaries.hide_timeout),this.panel_boundaries.show()}.bind(this)),M.a.select(this.svg.node().parentNode).on("mouseout."+this.id+".panel_boundaries",function(){this.panel_boundaries.hide_timeout=setTimeout(function(){this.panel_boundaries.hide()}.bind(this),300)}.bind(this))),this.dashboard=new D(this).show();for(let t in this.panels)this.panels[t].initialize();const t="."+this.id;if(this.layout.mouse_guide){const e=function(){this.mouse_guide.vertical.attr("x",-1),this.mouse_guide.horizontal.attr("y",-1)}.bind(this),i=function(){const t=M.a.mouse(this.svg.node());this.mouse_guide.vertical.attr("x",t[0]),this.mouse_guide.horizontal.attr("y",t[1])}.bind(this);this.svg.on("mouseout"+t+"-mouse_guide",e).on("touchleave"+t+"-mouse_guide",e).on("mousemove"+t+"-mouse_guide",i)}const e=function(){this.stopDrag()}.bind(this),i=function(){if(this.interaction.dragging){const t=M.a.mouse(this.svg.node());M.a.event&&M.a.event.preventDefault(),this.interaction.dragging.dragged_x=t[0]-this.interaction.dragging.start_x,this.interaction.dragging.dragged_y=t[1]-this.interaction.dragging.start_y,this.panels[this.interaction.panel_id].render(),this.interaction.linked_panel_ids.forEach(function(t){this.panels[t].render()}.bind(this))}}.bind(this);this.svg.on("mouseup"+t,e).on("touchend"+t,e).on("mousemove"+t,i).on("touchmove"+t,i),M.a.select("body").empty()||M.a.select("body").on("mouseup"+t,e).on("touchend"+t,e),this.on("match_requested",function(t){const e=t.data,i=e.active?e.value:null;this.applyState({lz_match_value:i})}.bind(this)),this.initialized=!0;const s=this.svg.node().getBoundingClientRect();var a=s.width?s.width:this.layout.width;const n=s.height?s.height:this.layout.height;return this.setDimensions(a,n),this}refresh(){return this.applyState()}subscribeToData(t,e,i){const s=(i=i||{}).onerror||function(t){console.log("An error occurred while acting on an external callback",t)},a=this,n=function(){try{a.lzd.getData(a.state,t).then((function(t){e(i.discrete?t.discrete:t.body)})).catch(s)}catch(t){s(t)}};return this.on("data_rendered",n),n}applyState(t){if("object"!=typeof(t=t||{}))throw new Error("applyState only accepts an object; "+typeof t+" given");let e={chr:this.state.chr,start:this.state.start,end:this.state.end};for(var i in t)e[i]=t[i];for(i in e=function(t,e){e=e||{};let i=!1;if(void 0!==(t=t||{}).chr&&void 0!==t.start&&void 0!==t.end){var s,a=null;if(t.start=Math.max(parseInt(t.start),1),t.end=Math.max(parseInt(t.end),1),isNaN(t.start)&&isNaN(t.end))t.start=1,t.end=1,a=.5,s=0;else if(isNaN(t.start)||isNaN(t.end))a=t.start||t.end,s=0,t.start=isNaN(t.start)?t.end:t.start,t.end=isNaN(t.end)?t.start:t.end;else{if(a=Math.round((t.start+t.end)/2),(s=t.end-t.start)<0){const e=t.start;t.end=t.start,t.start=e,s=t.end-t.start}a<0&&(t.start=1,t.end=1,s=0)}i=!0}return!isNaN(e.min_region_scale)&&i&&s<e.min_region_scale&&(t.start=Math.max(a-Math.floor(e.min_region_scale/2),1),t.end=t.start+e.min_region_scale),!isNaN(e.max_region_scale)&&i&&s>e.max_region_scale&&(t.start=Math.max(a-Math.floor(e.max_region_scale/2),1),t.end=t.start+e.max_region_scale),t}(e,this.layout),e)this.state[i]=e[i];this.emit("data_requested"),this.remap_promises=[],this.loading_data=!0;for(let t in this.panels)this.remap_promises.push(this.panels[t].reMap());return Promise.all(this.remap_promises).catch(function(t){console.error(t),this.curtain.show(t.message||t),this.loading_data=!1}.bind(this)).then(function(){this.dashboard.update(),this.panel_ids_by_y_index.forEach(function(t){const e=this.panels[t];e.dashboard.update(),e.data_layer_ids_by_z_index.forEach(function(t){this.data_layers[t].applyAllElementStatus()}.bind(e))}.bind(this)),this.emit("layout_changed"),this.emit("data_rendered"),this.emit("state_changed",t),this.loading_data=!1}.bind(this))}startDrag(t,e){t=t||null;let i=null;switch(e=e||null){case"background":case"x_tick":i="x";break;case"y1_tick":i="y1";break;case"y2_tick":i="y2"}if(!(t instanceof U&&i&&this.canInteract()))return this.stopDrag();const s=M.a.mouse(this.svg.node());return this.interaction={panel_id:t.id,linked_panel_ids:t.getLinkedPanelIds(i),dragging:{method:e,start_x:s[0],start_y:s[1],dragged_x:0,dragged_y:0,axis:i}},this.svg.style("cursor","all-scroll"),this}stopDrag(){if(!this.interaction.dragging)return this;if("object"!=typeof this.panels[this.interaction.panel_id])return this.interaction={},this;const t=this.panels[this.interaction.panel_id],e=function(e,i,s){t.data_layer_ids_by_z_index.forEach((function(a){t.data_layers[a].layout[e+"_axis"].axis===i&&(t.data_layers[a].layout[e+"_axis"].floor=s[0],t.data_layers[a].layout[e+"_axis"].ceiling=s[1],delete t.data_layers[a].layout[e+"_axis"].lower_buffer,delete t.data_layers[a].layout[e+"_axis"].upper_buffer,delete t.data_layers[a].layout[e+"_axis"].min_extent,delete t.data_layers[a].layout[e+"_axis"].ticks)}))};switch(this.interaction.dragging.method){case"background":case"x_tick":0!==this.interaction.dragging.dragged_x&&(e("x",1,t.x_extent),this.applyState({start:t.x_extent[0],end:t.x_extent[1]}));break;case"y1_tick":case"y2_tick":if(0!==this.interaction.dragging.dragged_y){const i=parseInt(this.interaction.dragging.method[1]);e("y",i,t["y"+i+"_extent"])}}return this.interaction={},this.svg.style("cursor",null),this}};function H(t,e,i){const s={0:"",3:"K",6:"M",9:"G"};if(i=i||!1,isNaN(e)||null===e){const i=Math.log(t)/Math.LN10;e=Math.min(Math.max(i-i%3,0),9)}const a=e-Math.floor((Math.log(t)/Math.LN10).toFixed(e+3)),n=Math.min(Math.max(e,0),2),o=Math.min(Math.max(a,n),12);let r=""+(t/Math.pow(10,e)).toFixed(o);return i&&void 0!==s[e]&&(r+=" "+s[e]+"b"),r}function G(t){let e=t.toUpperCase();e=e.replace(/,/g,"");const i=/([KMG])[B]*$/,s=i.exec(e);let a=1;return s&&(a="M"===s[1]?1e6:"G"===s[1]?1e9:1e3,e=e.replace(i,"")),e=Number(e)*a,e}function J(t,e){if("object"!=typeof t)throw new Error("LocusZoom.parseFields invalid arguments: data is not an object");if("string"!=typeof e)throw new Error("LocusZoom.parseFields invalid arguments: html is not a string");const i=[],s=/{{(?:(#if )?([A-Za-z0-9_:|]+)|(\/if))}}/;for(;e.length>0;){const t=s.exec(e);t?0!==t.index?(i.push({text:e.slice(0,t.index)}),e=e.slice(t.index)):"#if "===t[1]?(i.push({condition:t[2]}),e=e.slice(t[0].length)):t[2]?(i.push({variable:t[2]}),e=e.slice(t[0].length)):"/if"===t[3]?(i.push({close:"if"}),e=e.slice(t[0].length)):(console.error("Error tokenizing tooltip when remaining template is "+JSON.stringify(e)+" and previous tokens are "+JSON.stringify(i)+" and current regex match is "+JSON.stringify([t[1],t[2],t[3]])),e=e.slice(t[0].length)):(i.push({text:e}),e="")}const a=function(){const t=i.shift();if(void 0!==t.text||t.variable)return t;if(t.condition){for(t.then=[];i.length>0;){if("if"===i[0].close){i.shift();break}t.then.push(a())}return t}return console.error("Error making tooltip AST due to unknown token "+JSON.stringify(t)),{text:""}},n=[];for(;i.length>0;)n.push(a());const o=function(e){return Object.prototype.hasOwnProperty.call(o.cache,e)||(o.cache[e]=new O(e).resolve(t)),o.cache[e]};o.cache={};const r=function(t){if(void 0!==t.text)return t.text;if(t.variable){try{const e=o(t.variable);if(-1!==["string","number","boolean"].indexOf(typeof e))return e;if(null===e)return""}catch(e){console.error("Error while processing variable "+JSON.stringify(t.variable))}return"{{"+t.variable+"}}"}if(t.condition){try{const e=o(t.condition);if(e||0===e)return t.then.map(r).join("")}catch(e){console.error("Error while processing condition "+JSON.stringify(t.variable))}return""}console.error("Error rendering tooltip due to unknown AST node "+JSON.stringify(t))};return n.map(r).join("")}function K(t,e,i){if(void 0===t)throw new Error("LocusZoom.populate selector not defined");let s;return M.a.select(t).html(""),M.a.select(t).call((function(){if(void 0===this.node().id){let t=0;for(;!M.a.select("#lz-"+t).empty();)t++;this.attr("id","#lz-"+t)}if(s=new Z(this.node().id,e,i),s.container=this.node(),void 0!==this.node().dataset&&void 0!==this.node().dataset.region){const t=function(t){let e=/^(\w+):([\d,.]+[kmgbKMGB]*)([-+])([\d,.]+[kmgbKMGB]*)$/.exec(t);if(e){if("+"===e[3]){const t=G(e[2]),i=G(e[4]);return{chr:e[1],start:t-i,end:t+i}}return{chr:e[1],start:G(e[2]),end:G(e[4])}}if(e=/^(\w+):([\d,.]+[kmgbKMGB]*)$/.exec(t),e)return{chr:e[1],position:G(e[2])};return null}(this.node().dataset.region);Object.keys(t).forEach((function(e){s.state[e]=t[e]}))}s.svg=M.a.select("div#"+s.id).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("id",s.id+"_svg").attr("class","lz-locuszoom").style(s.layout.style),s.setDimensions(),s.positionPanels(),s.initialize(),e&&s.refresh()})),s}class $ extends N{show(){return this.div_selector||(this.div_selector=this.parent.selector.append("div").attr("class","lz-dashboard-title lz-dashboard-"+this.layout.position),this.title_selector=this.div_selector.append("h3")),this.update()}update(){let t=this.layout.title.toString();return this.layout.subtitle&&(t+=" <small>"+this.layout.subtitle+"</small>"),this.title_selector.html(t),this}}class V extends N{update(){const t=-1===this.parent_plot.layout.width.toString().indexOf(".")?this.parent_plot.layout.width:this.parent_plot.layout.width.toFixed(2),e=-1===this.parent_plot.layout.height.toString().indexOf(".")?this.parent_plot.layout.height:this.parent_plot.layout.height.toFixed(2);return this.selector.html(t+"px × "+e+"px"),this.layout.class&&this.selector.attr("class",this.layout.class),this.layout.style&&this.selector.style(this.layout.style),this}}class W extends N{update(){return isNaN(this.parent_plot.state.start)||isNaN(this.parent_plot.state.end)||null===this.parent_plot.state.start||null===this.parent_plot.state.end?this.selector.style("display","none"):(this.selector.style("display",null),this.selector.html(H(this.parent_plot.state.end-this.parent_plot.state.start,null,!0))),this.layout.class&&this.selector.attr("class",this.layout.class),this.layout.style&&this.selector.style(this.layout.style),this}}class Y extends N{constructor(t,e){super(t,e),this.css_string="";for(let t in Object.keys(document.styleSheets))if(null!==document.styleSheets[t].href&&-1!==document.styleSheets[t].href.indexOf("locuszoom.css")){fetch(document.styleSheets[t].href).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.text()}).then(t=>{this.css_string=t.replace(/[\r\n]/g," ").replace(/\s+/g," "),this.css_string.indexOf("/* ! LocusZoom HTML Styles */")&&(this.css_string=this.css_string.substring(0,this.css_string.indexOf("/* ! LocusZoom HTML Styles */")))});break}}update(){return this.button||(this.button=new S(this).setColor(this.layout.color).setHtml(this.layout.button_html||"Download Image").setTitle(this.layout.button_title||"Download image of the current plot as locuszoom.svg").setOnMouseover(function(){this.button.selector.classed("lz-dashboard-button-gray-disabled",!0).html("Preparing Image"),this.generateBase64SVG().then(function(t){const e=this.button.selector.attr("href");e&&URL.revokeObjectURL(e),this.button.selector.attr("href",t).classed("lz-dashboard-button-gray-disabled",!1).classed("lz-dashboard-button-gray-highlighted",!0).html(this.layout.button_html||"Download Image")}.bind(this))}.bind(this)).setOnMouseout(function(){this.button.selector.classed("lz-dashboard-button-gray-highlighted",!1)}.bind(this)),this.button.show(),this.button.selector.attr("href-lang","image/svg+xml").attr("download",this.layout.filename||"locuszoom.svg")),this}generateBase64SVG(){return new Promise(t=>{const e=this.parent.selector.append("div").style("display","none").html(this.parent_plot.svg.node().outerHTML);e.selectAll("g.lz-curtain").remove(),e.selectAll("g.lz-mouse_guide").remove(),e.selectAll("g.tick text").each((function(){const t=10*+M.a.select(this).attr("dy").substring(-2).slice(0,-2);M.a.select(this).attr("dy",t)}));let i=M.a.select(e.select("svg").node().parentNode).html();const s='<style type="text/css"><![CDATA[ '+this.css_string+" ]]></style>",a=i.indexOf(">")+1;i=i.slice(0,a)+s+i.slice(a),e.remove();const n=new Blob([i],{type:"image/svg+xml"});t(URL.createObjectURL(n))})}}class Q extends N{update(){return this.button||(this.button=new S(this).setColor(this.layout.color).setHtml("×").setTitle("Remove panel").setOnclick(function(){if(!this.layout.suppress_confirm&&!confirm("Are you sure you want to remove this panel? This cannot be undone!"))return!1;const t=this.parent_panel;return t.dashboard.hide(!0),M.a.select(t.parent.svg.node().parentNode).on("mouseover."+t.getBaseId()+".dashboard",null),M.a.select(t.parent.svg.node().parentNode).on("mouseout."+t.getBaseId()+".dashboard",null),t.parent.removePanel(t.id)}.bind(this)),this.button.show()),this}}class X extends N{update(){if(this.button){const t=0===this.parent_panel.layout.y_index;return this.button.disable(t),this}return this.button=new S(this).setColor(this.layout.color).setHtml("▴").setTitle("Move panel up").setOnclick(()=>{this.parent_panel.moveUp(),this.update()}),this.button.show(),this.update()}}class tt extends N{update(){if(this.button){const t=this.parent_panel.layout.y_index===this.parent_plot.panel_ids_by_y_index.length-1;return this.button.disable(t),this}return this.button=new S(this).setColor(this.layout.color).setHtml("▾").setTitle("Move panel down").setOnclick(()=>{this.parent_panel.moveDown(),this.update()}),this.button.show(),this.update()}}class et extends N{constructor(t,e){if((isNaN(t.step)||0===t.step)&&(t.step=5e4),"string"!=typeof t.button_html&&(t.button_html=t.step>0?">":"<"),"string"!=typeof t.button_title&&(t.button_title="Shift region by "+(t.step>0?"+":"-")+H(Math.abs(t.step),null,!0)),super(t,e),isNaN(this.parent_plot.state.start)||isNaN(this.parent_plot.state.end))throw new Error("Unable to add shift_region dashboard component: plot state does not have region bounds")}update(){return this.button||(this.button=new S(this).setColor(this.layout.color).setHtml(this.layout.button_html).setTitle(this.layout.button_title).setOnclick(()=>{this.parent_plot.applyState({start:Math.max(this.parent_plot.state.start+this.layout.step,1),end:this.parent_plot.state.end+this.layout.step})}),this.button.show()),this}}class it extends N{constructor(t,e){if((isNaN(t.step)||0===t.step)&&(t.step=.2),"string"!=typeof t.button_html&&(t.button_html=t.step>0?"z–":"z+"),"string"!=typeof t.button_title&&(t.button_title="Zoom region "+(t.step>0?"out":"in")+" by "+(100*Math.abs(t.step)).toFixed(1)+"%"),super(t,e),isNaN(this.parent_plot.state.start)||isNaN(this.parent_plot.state.end))throw new Error("Unable to add zoom_region dashboard component: plot state does not have region bounds")}update(){if(this.button){let t=!0;const e=this.parent_plot.state.end-this.parent_plot.state.start;return this.layout.step>0&&!isNaN(this.parent_plot.layout.max_region_scale)&&e>=this.parent_plot.layout.max_region_scale&&(t=!1),this.layout.step<0&&!isNaN(this.parent_plot.layout.min_region_scale)&&e<=this.parent_plot.layout.min_region_scale&&(t=!1),this.button.disable(!t),this}return this.button=new S(this).setColor(this.layout.color).setHtml(this.layout.button_html).setTitle(this.layout.button_title).setOnclick(()=>{const t=this.parent_plot.state.end-this.parent_plot.state.start;let e=t*(1+this.layout.step);isNaN(this.parent_plot.layout.max_region_scale)||(e=Math.min(e,this.parent_plot.layout.max_region_scale)),isNaN(this.parent_plot.layout.min_region_scale)||(e=Math.max(e,this.parent_plot.layout.min_region_scale));const i=Math.floor((e-t)/2);this.parent_plot.applyState({start:Math.max(this.parent_plot.state.start-i,1),end:this.parent_plot.state.end+i})}),this.button.show(),this}}class st extends N{update(){return this.button||(this.button=new S(this).setColor(this.layout.color).setHtml(this.layout.button_html).setTitle(this.layout.button_title),this.button.menu.setPopulate(()=>{this.button.menu.inner_selector.html(this.layout.menu_html)}),this.button.show()),this}}class at extends N{update(){return this.button||(this.button=new S(this).setColor(this.layout.color).setHtml(this.layout.button_html||"Resize to Data").setTitle(this.layout.button_title||"Automatically resize this panel to show all data available").setOnclick(()=>{this.parent_panel.scaleHeightToData(),this.update()}),this.button.show()),this}}class nt extends N{update(){const t=this.parent_panel.legend.layout.hidden?"Show Legend":"Hide Legend";return this.button?(this.button.setHtml(t).show(),this.parent.position(),this):(this.button=new S(this).setColor(this.layout.color).setTitle("Show or hide the legend for this panel").setOnclick(()=>{this.parent_panel.legend.layout.hidden=!this.parent_panel.legend.layout.hidden,this.parent_panel.legend.render(),this.update()}),this.update())}}class ot extends N{constructor(t,e){"string"!=typeof t.button_html&&(t.button_html="Display options..."),"string"!=typeof t.button_title&&(t.button_title="Control how plot items are displayed"),super(t,e);const i=t.fields_whitelist||["color","fill_opacity","label","legend","point_shape","point_size","tooltip","tooltip_positioning"],s=this.parent_panel.data_layers[t.layer_name];if(!s)throw new Error("Display options could not locate the specified layer_name: '"+t.layer_name+"'");const a=s.layout,n={};i.forEach((function(t){const e=a[t];void 0!==e&&(n[t]=JSON.parse(JSON.stringify(e)))})),this._selected_item="default",this.button=new S(this).setColor(t.color).setHtml(t.button_html).setTitle(t.button_title).setOnclick((function(){this.button.menu.populate()})),this.button.menu.setPopulate(()=>{const t=Math.floor(1e4*Math.random()).toString();this.button.menu.inner_selector.html("");const e=this.button.menu.inner_selector.append("table"),a=this.layout,o=function(a,o,r){const l=e.append("tr"),h=""+t+r;l.append("td").append("input").attr({id:h,type:"radio",name:"display-option-"+t,value:r}).style("margin",0).property("checked",r===this._selected_item).on("click",()=>{i.forEach((function(t){s.layout[t]=o[t]||n[t]})),this._selected_item=r,this.parent_panel.render();const t=this.parent_panel.legend;t&&t.render()}),l.append("td").append("label").style("font-weight","normal").attr("for",h).text(a)},r=a.default_config_display_name||"Default style";return o(r,n,"default"),a.options.forEach((function(t,e){o(t.display_name,t.display,e)})),this})}update(){return this.button.show(),this}}class rt extends N{constructor(t,e){if("string"!=typeof t.button_html&&(t.button_html="Set option..."),"string"!=typeof t.button_title&&(t.button_title="Choose an option to customize the plot"),super(t,e),this.parent_panel)throw new Error("This widget is designed to set global options, so it can only be used at the top (plot) level");if(!t.state_field)throw new Error("Must specify the `state_field` that this widget controls");if(this._selected_item=this.parent_plot.state[t.state_field]||t.options[0].value,!t.options.find(t=>t.value===this._selected_item))throw new Error("There is an existing state value that does not match the known values in this widget");this.button=new S(this).setColor(t.color).setHtml(t.button_html+(t.show_selected?this._selected_item:"")).setTitle(t.button_title).setOnclick(()=>{this.button.menu.populate()}),this.button.menu.setPopulate(()=>{const e=Math.floor(1e4*Math.random()).toString();this.button.menu.inner_selector.html("");const i=this.button.menu.inner_selector.append("table"),s=(s,a,n)=>{const o=i.append("tr"),r=""+e+n;o.append("td").append("input").attr({id:r,type:"radio",name:"set-state-"+e,value:n}).style("margin",0).property("checked",a===this._selected_item).on("click",()=>{const e={};e[t.state_field]=a,this._selected_item=a,this.parent_plot.applyState(e),this.button.setHtml(t.button_html+(t.show_selected?this._selected_item:""))}),o.append("td").append("label").style("font-weight","normal").attr("for",r).text(s)};return t.options.forEach((function(t,e){s(t.display_name,t.value,e)})),this})}update(){return this.button.show(),this}}const lt=new d;for(let[t,e]of Object.entries(a))lt.add(t,e);var ht=lt;const dt={type:"",fields:[],x_axis:{},y_axis:{},tooltip_positioning:"horizontal"};class ct{constructor(t,e){this.initialized=!1,this.layout_idx=null,this.id=null,this.parent=e||null,this.svg={},this.parent_plot=null,e&&(this.parent_plot=e.parent),this.layout=A(t||{},dt),this.layout.id&&(this.id=this.layout.id),this.layout.x_axis!=={}&&"number"!=typeof this.layout.x_axis.axis&&(this.layout.x_axis.axis=1),this.layout.y_axis!=={}&&"number"!=typeof this.layout.y_axis.axis&&(this.layout.y_axis.axis=1),this._base_layout=JSON.parse(JSON.stringify(this.layout)),this.state={},this.state_id=null,this.layer_state=null,this._setDefaultState(),this.data=[],this.layout.tooltip&&(this.tooltips={}),this.global_statuses={highlighted:!1,selected:!1,faded:!1,hidden:!1}}addField(t,e,i){if(!t||!e)throw new Error("Must specify field name and namespace to use when adding field");let s=e+":"+t;if(i)if(s+="|","string"==typeof i)s+=i;else{if(!Array.isArray(i))throw new Error("Must provide transformations as either a string or array of strings");s+=i.join("|")}const a=this.layout.fields;return-1===a.indexOf(s)&&a.push(s),s}_setDefaultState(){const t={status_flags:{},extra_fields:{}},e=t.status_flags;P.adjectives.forEach((function(t){e[t]=e[t]||[]})),e.has_tooltip=e.has_tooltip||[],this.parent&&(this.state_id=this.parent.id+"."+this.id,this.state=this.parent.state,this.state[this.state_id]=t),this.layer_state=t}getBaseId(){return this.parent?this.parent_plot.id+"."+this.parent.id+"."+this.id:""}getAbsoluteDataHeight(){return this.svg.group.node().getBoundingClientRect().height}getElementId(t){let e="element";if("string"==typeof t)e=t;else if("object"==typeof t){const i=this.layout.id_field||"id";if(void 0===t[i])throw new Error("Unable to generate element ID");e=t[i].toString().replace(/\W/g,"")}return(this.getBaseId()+"-"+e).replace(/([:.[\],])/g,"_")}getElementStatusNodeId(t){return null}getElementById(t){const e=M.a.select("#"+t.replace(/([:.[\],])/g,"\\$1"));return!e.empty()&&e.data()&&e.data().length?e.data()[0]:null}applyDataMethods(){const t=this.layout.match&&this.layout.match.receive,e=this.parent_plot.state.lz_match_value,i=this;return this.data.forEach((function(s,a){t&&null!=e&&(s.lz_highlight_match=s[t]===e),i.data[a].toHTML=function(){const t=i.layout.id_field||"id";let e="";return i.data[a][t]&&(e=i.data[a][t].toString()),e},i.data[a].getDataLayer=function(){return i},i.data[a].deselect=function(){i.getDataLayer().unselectElement(i)}})),this.applyCustomDataMethods(),this}applyCustomDataMethods(){return this}initialize(){return this.svg.container=this.parent.svg.group.append("g").attr("class","lz-data_layer-container").attr("id",this.getBaseId()+".data_layer_container"),this.svg.clipRect=this.svg.container.append("clipPath").attr("id",this.getBaseId()+".clip").append("rect"),this.svg.group=this.svg.container.append("g").attr("id",this.getBaseId()+".data_layer").attr("clip-path","url(#"+this.getBaseId()+".clip)"),this}moveUp(){return this.parent.data_layer_ids_by_z_index[this.layout.z_index+1]&&(this.parent.data_layer_ids_by_z_index[this.layout.z_index]=this.parent.data_layer_ids_by_z_index[this.layout.z_index+1],this.parent.data_layer_ids_by_z_index[this.layout.z_index+1]=this.id,this.parent.resortDataLayers()),this}moveDown(){return this.parent.data_layer_ids_by_z_index[this.layout.z_index-1]&&(this.parent.data_layer_ids_by_z_index[this.layout.z_index]=this.parent.data_layer_ids_by_z_index[this.layout.z_index-1],this.parent.data_layer_ids_by_z_index[this.layout.z_index-1]=this.id,this.parent.resortDataLayers()),this}resolveScalableParameter(t,e,i){let s=null;if(Array.isArray(t)){let a=0;for(;null===s&&a<t.length;)s=this.resolveScalableParameter(t[a],e,i),a++}else switch(typeof t){case"number":case"string":s=t;break;case"object":if(t.scale_function)if(t.field){const a=new O(t.field);let n;try{n=this.layer_state&&this.layer_state.extra_fields[this.getElementId(e)]}catch(t){n=null}s=fe.get(t.scale_function)(t.parameters||{},a.resolve(e,n),i)}else s=fe.get(t.scale_function)(t.parameters||{},e,i)}return s}_getDataExtent(t,e){return t=t||this.data,M.a.extent(t,(function(t){return+new O(e.field).resolve(t)}))}getAxisExtent(t){if(-1===["x","y"].indexOf(t))throw new Error("Invalid dimension identifier passed to BaseDataLayer.getAxisExtent()");const e=t+"_axis",i=this.layout[e];if(!isNaN(i.floor)&&!isNaN(i.ceiling))return[+i.floor,+i.ceiling];let s=[];if(i.field&&this.data){if(this.data.length){s=this._getDataExtent(this.data,i);const t=s[1]-s[0];if(isNaN(i.lower_buffer)||(s[0]-=t*i.lower_buffer),isNaN(i.upper_buffer)||(s[1]+=t*i.upper_buffer),"object"==typeof i.min_extent){const t=i.min_extent[0],e=i.min_extent[1];isNaN(t)||isNaN(e)||(s[0]=Math.min(s[0],t)),isNaN(e)||(s[1]=Math.max(s[1],e))}return[isNaN(i.floor)?s[0]:i.floor,isNaN(i.ceiling)?s[1]:i.ceiling]}return s=i.min_extent||[],s}return"x"!==t||isNaN(this.state.start)||isNaN(this.state.end)?[]:[this.state.start,this.state.end]}getTicks(t,e){if(-1===["x","y1","y2"].indexOf(t))throw new Error("Invalid dimension identifier at layer level"+t);return[]}createTooltip(t){if("object"!=typeof this.layout.tooltip)throw new Error("DataLayer ["+this.id+"] layout does not define a tooltip");const e=this.getElementId(t);if(!this.tooltips[e])return this.tooltips[e]={data:t,arrow:null,selector:M.a.select(this.parent_plot.svg.node().parentNode).append("div").attr("class","lz-data_layer-tooltip").attr("id",e+"-tooltip")},this.layer_state.status_flags.has_tooltip.push(e),this.updateTooltip(t),this;this.positionTooltip(e)}updateTooltip(t,e){return void 0===e&&(e=this.getElementId(t)),this.tooltips[e].selector.html(""),this.tooltips[e].arrow=null,this.layout.tooltip.html&&this.tooltips[e].selector.html(J(t,this.layout.tooltip.html)),this.layout.tooltip.closable&&this.tooltips[e].selector.insert("button",":first-child").attr("class","lz-tooltip-close-button").attr("title","Close").text("×").on("click",function(){this.destroyTooltip(e)}.bind(this)),this.tooltips[e].selector.data([t]),this.positionTooltip(e),this}destroyTooltip(t,e){let i;if(i="string"==typeof t?t:this.getElementId(t),this.tooltips[i]&&("object"==typeof this.tooltips[i].selector&&this.tooltips[i].selector.remove(),delete this.tooltips[i]),!e){const t=this.layer_state.status_flags.has_tooltip,e=t.indexOf(i);t.splice(e,1)}return this}destroyAllTooltips(){for(let t in this.tooltips)this.destroyTooltip(t,!0);return this}positionTooltip(t){if("string"!=typeof t)throw new Error("Unable to position tooltip: id is not a string");if(!this.tooltips[t])throw new Error("Unable to position tooltip: id does not point to a valid tooltip");const e=this.tooltips[t],i=this._getTooltipPosition(e);if(!i)return null;this._drawTooltip(e,this.layout.tooltip_positioning,i.x_min,i.x_max,i.y_min,i.y_max)}_getTooltipPosition(t){const e=this.parent,i=e["y"+this.layout.y_axis.axis+"_scale"],s=e["y"+this.layout.y_axis.axis+"_extent"],a=e.x_scale(e.x_extent[0]),n=i(s[0]);return{x_min:a,x_max:a,y_min:n,y_max:n}}_drawTooltip(t,e,i,s,a,n){const o=this.parent.layout,r=this.layout,l=this.getPageOrigin(),h=t.selector.node().getBoundingClientRect(),d=o.height-(o.margin.top+o.margin.bottom),c=o.width-(o.margin.left+o.margin.right),u=((i=Math.max(i,0))+(s=Math.min(s,c)))/2,p=((a=Math.max(a,0))+(n=Math.min(n,d)))/2;let _,y,g,f,m,x=s-u,b=n-p,v=r.tooltip_positioning;if("vertical"===v?(x=0,v=h.height+8>d-(p+b)?"top":"bottom"):"horizontal"===v&&(b=0,v=u<=o.width/2?"left":"right"),"top"===v||"bottom"===v){const t=Math.max(h.width/2-u,0),e=Math.max(h.width/2+u-c,0);y=l.x+u-h.width/2-e+t,m=l.x+u-y-7,"top"===v?(_=l.y+p-(b+h.height+8),g="down",f=h.height-1):(_=l.y+p+b+8,g="up",f=-8)}else{if("left"!==v&&"right"!==v)throw new Error("Unrecognized placement value");"left"===v?(y=l.x+u+x+8,g="left",m=-8):(y=l.x+u-h.width-x-8,g="right",m=h.width-1),p-h.height/2<=0?(_=l.y+p-10.5-6,f=6):p+h.height/2>=d?(_=l.y+p+7+6-h.height,f=h.height-14-6):(_=l.y+p-h.height/2,f=h.height/2-7)}return t.selector.style("left",y+"px").style("top",_+"px"),t.arrow||(t.arrow=t.selector.append("div").style("position","absolute")),t.arrow.attr("class","lz-data_layer-tooltip-arrow_"+g).style("left",m+"px").style("top",f+"px"),this}positionAllTooltips(){for(let t in this.tooltips)this.positionTooltip(t);return this}showOrHideTooltip(t,e){if("object"!=typeof this.layout.tooltip)return this;const i=this.getElementId(t),s=function(t,e,i){let a=null;if("object"!=typeof t||null===t)return null;if(Array.isArray(e))i=i||"and",a=1===e.length?t[e[0]]:e.reduce((function(e,s){return"and"===i?t[e]&&t[s]:"or"===i?t[e]||t[s]:null}));else{if("object"!=typeof e)return!1;{let n;for(let o in e)n=s(t,e[o],o),null===a?a=n:"and"===i?a=a&&n:"or"===i&&(a=a||n)}}return a};let a={};"string"==typeof this.layout.tooltip.show?a={and:[this.layout.tooltip.show]}:"object"==typeof this.layout.tooltip.show&&(a=this.layout.tooltip.show);let n={};"string"==typeof this.layout.tooltip.hide?n={and:[this.layout.tooltip.hide]}:"object"==typeof this.layout.tooltip.hide&&(n=this.layout.tooltip.hide);const o=this.layer_state;var r={};P.adjectives.forEach((function(t){const e="un"+t;r[t]=-1!==o.status_flags[t].indexOf(i),r[e]=!r[t]}));const l=s(r,a),h=s(r,n),d=-1!==o.status_flags.has_tooltip.indexOf(i);return!l||!e&&!d||h?this.destroyTooltip(t):this.createTooltip(t),this}filter(t,e){if(void 0!==e&&-1!==["indexes","elements"].indexOf(e)||(e="indexes"),!Array.isArray(t))return[];const i=[];return this.data.forEach((function(s,a){let n=!0;t.forEach((function(t){(function(t,e){const i={"=":(t,e)=>t===e,"!=":(t,e)=>t!=e,"<":(t,e)=>t<e,"<=":(t,e)=>t<=e,">":(t,e)=>t>e,">=":(t,e)=>t>=e,"%":(t,e)=>t%e};return!!Array.isArray(e)&&(2===e.length?t[e[0]]===e[1]:!(3!==e.length||!i[e[1]])&&i[e[1]](t[e[0]],e[2]))})(s,t)||(n=!1)})),n&&i.push("indexes"===e?a:s)})),i}filterIndexes(t){return this.filter(t,"indexes")}filterElements(t){return this.filter(t,"elements")}setElementStatus(t,e,i,s){if("has_tooltip"===t)return this;let a;void 0===i&&(i=!0);try{a=this.getElementId(e)}catch(t){return this}s&&this.setAllElementStatus(t,!i),M.a.select("#"+a).classed("lz-data_layer-"+this.layout.type+"-"+t,i);const n=this.getElementStatusNodeId(e);null!==n&&M.a.select("#"+n).classed("lz-data_layer-"+this.layout.type+"-statusnode-"+t,i);const o=this.layer_state.status_flags[t].indexOf(a),r=-1===o;i&&r&&this.layer_state.status_flags[t].push(a),i||r||this.layer_state.status_flags[t].splice(o,1),this.showOrHideTooltip(e,r),r&&this.parent.emit("layout_changed",!0);const l="selected"===t;!l||!r&&i||this.parent.emit("element_selection",{element:e,active:i},!0);const h=this.layout.match&&this.layout.match.send;return l&&h&&(r||!i)&&this.parent.emit("match_requested",{value:e[h],active:i},!0),this}setElementStatusByFilters(t,e,i,s){if(void 0===t||-1===P.adjectives.indexOf(t))throw new Error("Invalid status passed to DataLayer.setElementStatusByFilters()");return void 0===this.layer_state.status_flags[t]||(e=void 0===e||!!e,s=void 0!==s&&!!s,Array.isArray(i)||(i=[]),s&&this.setAllElementStatus(t,!e),this.filterElements(i).forEach(function(i){this.setElementStatus(t,i,e)}.bind(this))),this}setAllElementStatus(t,e){if(void 0===t||-1===P.adjectives.indexOf(t))throw new Error("Invalid status passed to DataLayer.setAllElementStatus()");if(void 0===this.layer_state.status_flags[t])return this;void 0===e&&(e=!0);const i=this;if(e)this.data.forEach((function(e){i.setElementStatus(t,e,!0)}));else{this.layer_state.status_flags[t].slice().forEach((function(e){const s=i.getElementById(e);"object"==typeof s&&null!==s&&i.setElementStatus(t,s,!1)})),this.layer_state.status_flags[t]=[]}return this.global_statuses[t]=e,this}setElementAnnotation(t,e,i){const s=this.getElementId(t);return this.layer_state.extra_fields[s]||(this.layer_state.extra_fields[s]={}),this.layer_state.extra_fields[s][e]=i,this}getElementAnnotation(t,e){const i=this.getElementId(t),s=this.layer_state.extra_fields[i];return s&&s[e]}applyBehaviors(t){"object"==typeof this.layout.behaviors&&Object.keys(this.layout.behaviors).forEach(e=>{const i=/(click|mouseover|mouseout)/.exec(e);i&&t.on(i[0]+"."+e,this.executeBehaviors(e,this.layout.behaviors[e]))})}executeBehaviors(t,e){const i=-1!==t.indexOf("ctrl"),s=-1!==t.indexOf("shift"),a=this;return function(t){i===!!M.a.event.ctrlKey&&s===!!M.a.event.shiftKey&&e.forEach((function(e){if("object"!=typeof e||null===e)return;const i=-1!==a.layer_state.status_flags[e.status].indexOf(a.getElementId(t)),s=e.exclusive&&!i;switch(e.action){case"set":a.setElementStatus(e.status,t,!0,e.exclusive);break;case"unset":a.setElementStatus(e.status,t,!1,e.exclusive);break;case"toggle":a.setElementStatus(e.status,t,!i,s);break;case"link":if("string"==typeof e.href){const i=J(t,e.href);"string"==typeof e.target?window.open(i,e.target):window.location.href=i}}}))}}getPageOrigin(){const t=this.parent.getPageOrigin();return{x:t.x+this.parent.layout.margin.left,y:t.y+this.parent.layout.margin.top}}applyAllElementStatus(){const t=this.layer_state.status_flags,e=this;for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&Array.isArray(t[i])&&t[i].forEach((function(t){try{e.setElementStatus(i,e.getElementById(t),!0)}catch(t){console.warn("Unable to apply state: "+e.state_id+", "+i),console.error(t)}}))}draw(){return this.svg.container.attr("transform","translate("+this.parent.layout.cliparea.origin.x+","+this.parent.layout.cliparea.origin.y+")"),this.svg.clipRect.attr("width",this.parent.layout.cliparea.width).attr("height",this.parent.layout.cliparea.height),this.positionAllTooltips(),this}reMap(){this.destroyAllTooltips();const t=this.parent_plot.lzd.getData(this.state,this.layout.fields);return t.then(function(t){this.data=t.body,this.applyDataMethods(),this.initialized=!0}.bind(this)),t}}P.verbs.forEach((function(t,e){const i=P.adjectives[e],s="un"+t;ct.prototype[t+"Element"]=function(t,e){return e=void 0!==e&&!!e,this.setElementStatus(i,t,!0,e),this},ct.prototype[s+"Element"]=function(t,e){return e=void 0!==e&&!!e,this.setElementStatus(i,t,!1,e),this},ct.prototype[t+"ElementsByFilters"]=function(t,e){return e=void 0!==e&&!!e,this.setElementStatusByFilters(i,!0,t,e)},ct.prototype[s+"ElementsByFilters"]=function(t,e){return e=void 0!==e&&!!e,this.setElementStatusByFilters(i,!1,t,e)},ct.prototype[t+"AllElements"]=function(){return this.setAllElementStatus(i,!0),this},ct.prototype[s+"AllElements"]=function(){return this.setAllElementStatus(i,!1),this}}));var ut=ct;const pt={color:"#000000",filters:[],tooltip_positioning:"vertical",hitarea_width:8};var _t=class extends ut{constructor(t){if(!Array.isArray(t.filters))throw new Error("Annotation track must specify array of filters for selecting points to annotate");A(t,pt),super(...arguments)}render(){const t=this,e=this.filter(this.layout.filters,"elements");let i=this.svg.group.select("g.lz-data_layer-"+t.layout.type+"-visible_lines");0===i.size()&&(i=this.svg.group.append("g").attr("class","lz-data_layer-"+t.layout.type+"-visible_lines"));const s=i.selectAll("rect.lz-data_layer-"+t.layout.type).data(e,(function(e){return e[t.layout.id_field]}));s.enter().append("rect").attr("class","lz-data_layer-"+this.layout.type).attr("id",(function(e){return t.getElementId(e)}));s.attr("x",(function(e){return t.parent.x_scale(e[t.layout.x_axis.field])-.5})).attr("width",1).attr("height",t.parent.layout.height).attr("fill",(function(e,i){return t.resolveScalableParameter(t.layout.color,e,i)})),s.exit().remove();let a=this.svg.group.select("g.lz-data_layer-"+t.layout.type+"-hit_areas");0===a.size()&&(a=this.svg.group.append("g").attr("class","lz-data_layer-"+t.layout.type+"-hit_areas"));const n=a.selectAll("rect.lz-data_layer-"+t.layout.type).data(e,(function(e){return e[t.layout.id_field]}));n.enter().append("rect").attr("class","lz-data_layer-"+this.layout.type).attr("id",(function(e){return t.getElementId(e)}));const o=function(i,s){const a=t.parent.x_scale(i[t.layout.x_axis.field]);let n=a-t.layout.hitarea_width/2;if(s>=1){const i=e[s-1],o=t.parent.x_scale(i[t.layout.x_axis.field]);n=Math.max(n,(a+o)/2)}return[n,a]};n.attr("height",t.parent.layout.height).attr("opacity",0).attr("x",(function(t,e){return o(t,e)[0]})).attr("width",(function(e,i){const s=o(e,i);return s[1]-s[0]+t.layout.hitarea_width/2})),n.exit().remove(),this.applyBehaviors(n)}_getTooltipPosition(t){const e=this.parent,i=e.layout.height-(e.layout.margin.top+e.layout.margin.bottom),s=e.x_scale(t.data[this.layout.x_axis.field]),a=i/2;return{x_min:s-1,x_max:s+1,y_min:a-e.layout.margin.top,y_max:a+e.layout.margin.bottom}}};const yt={color:"seagreen",hitarea_width:"10px",style:{fill:"none","stroke-width":"1px","stroke-opacity":"100%"},tooltip_positioning:"top"};var gt=class extends ut{constructor(t){t=A(t,yt),super(...arguments)}render(){var t=this,e=t.layout,i=t.parent.x_scale,s=t.parent["y"+e.y_axis.axis+"_scale"],a=e.filters||[],n=this.filter(a,"elements");function o(t){var a=t[e.x_axis.field1],n=t[e.x_axis.field2],o=(a+n)/2,r=[[i(a),s(0)],[i(o),s(t[e.y_axis.field])],[i(n),s(0)]];return M.a.svg.line().interpolate("monotone").x((function(t){return t[0]})).y((function(t){return t[1]}))(r)}var r=this.svg.group.selectAll("path.lz-data_layer-arcs").data(n,(function(e){return t.getElementId(e)})),l=this.svg.group.selectAll("path.lz-data_layer-arcs-hitarea").data(n,(function(e){return t.getElementId(e)}));return r.enter().append("path").attr("class","lz-data_layer-arcs").attr("id",(function(e){return t.getElementId(e)})),l.enter().append("path").attr("class","lz-data_layer-arcs-hitarea").attr("id",(function(e){return t.getElementId(e)})),r.style(e.style).attr("stroke",(function(e,i){return t.resolveScalableParameter(t.layout.color,e,i)})).attr("d",(function(t,e){return o(t)})),l.style({fill:"none","stroke-width":e.hitarea_width,"stroke-opacity":0,stroke:"transparent"}).attr("d",(function(t,e){return o(t)})),r.exit().remove(),l.exit().remove(),this.applyBehaviors(l),this}_getTooltipPosition(t){var e=this.parent,i=this.layout,s=t.data[i.x_axis.field1],a=t.data[i.x_axis.field2],n=e["y"+i.y_axis.axis+"_scale"];return{x_min:e.x_scale(Math.min(s,a)),x_max:e.x_scale(Math.max(s,a)),y_min:n(t.data[i.y_axis.field]),y_max:n(0)}}};const ft={point_size:40,point_shape:"square",color:"#888888",fill_opacity:1,y_axis:{axis:2},id_field:"id",confidence_intervals:{start_field:"ci_start",end_field:"ci_end"},show_no_significance_line:!0};class mt extends ut{constructor(t){t=A(t,ft),super(...arguments)}_getTooltipPosition(t){const e=this.parent.x_scale(t.data[this.layout.x_axis.field]),i="y"+this.layout.y_axis.axis+"_scale",s=this.parent[i](t.data[this.layout.y_axis.field]),a=this.resolveScalableParameter(this.layout.point_size,t.data),n=Math.sqrt(a/Math.PI);return{x_min:e-n,x_max:e+n,y_min:s-n,y_max:s+n}}render(){const t="y"+this.layout.y_axis.axis+"_scale";if(this.layout.confidence_intervals&&-1!==this.layout.fields.indexOf(this.layout.confidence_intervals.start_field)&&-1!==this.layout.fields.indexOf(this.layout.confidence_intervals.end_field)){const e=this.svg.group.selectAll("rect.lz-data_layer-forest.lz-data_layer-forest-ci").data(this.data,function(t){return t[this.layout.id_field]}.bind(this));e.enter().append("rect").attr("class","lz-data_layer-forest lz-data_layer-forest-ci").attr("id",function(t){return this.getElementId(t)+"_ci"}.bind(this)).attr("transform","translate(0,"+(isNaN(this.parent.layout.height)?0:this.parent.layout.height)+")");const i=function(e){let i=this.parent.x_scale(e[this.layout.confidence_intervals.start_field]),s=this.parent[t](e[this.layout.y_axis.field]);return isNaN(i)&&(i=-1e3),isNaN(s)&&(s=-1e3),"translate("+i+","+s+")"}.bind(this),s=function(t){return this.parent.x_scale(t[this.layout.confidence_intervals.end_field])-this.parent.x_scale(t[this.layout.confidence_intervals.start_field])}.bind(this),a=1;e.attr("transform",i).attr("width",s).attr("height",a),e.exit().remove()}const e=this.svg.group.selectAll("path.lz-data_layer-forest.lz-data_layer-forest-point").data(this.data,function(t){return t[this.layout.id_field]}.bind(this)),i=isNaN(this.parent.layout.height)?0:this.parent.layout.height;e.enter().append("path").attr("class","lz-data_layer-forest lz-data_layer-forest-point").attr("id",function(t){return this.getElementId(t)}.bind(this)).attr("transform","translate(0,"+i+")");const s=function(e){let i=this.parent.x_scale(e[this.layout.x_axis.field]),s=this.parent[t](e[this.layout.y_axis.field]);return isNaN(i)&&(i=-1e3),isNaN(s)&&(s=-1e3),"translate("+i+","+s+")"}.bind(this),a=function(t,e){return this.resolveScalableParameter(this.layout.color,t,e)}.bind(this),n=function(t,e){return this.resolveScalableParameter(this.layout.fill_opacity,t,e)}.bind(this),o=M.a.svg.symbol().size(function(t,e){return this.resolveScalableParameter(this.layout.point_size,t,e)}.bind(this)).type(function(t,e){return this.resolveScalableParameter(this.layout.point_shape,t,e)}.bind(this));e.attr("transform",s).attr("fill",a).attr("fill-opacity",n).attr("d",o),e.exit().remove(),e.on("click.event_emitter",function(t){this.parent.emit("element_clicked",t,!0)}.bind(this)),this.applyBehaviors(e)}}class xt extends mt{_getDataExtent(t,e){const i=this.layout.confidence_intervals;if(i&&-1!==this.layout.fields.indexOf(i.start_field)&&-1!==this.layout.fields.indexOf(i.end_field)){const e=function(t){return+new O(i.start_field).resolve(t)},s=function(t){return+new O(i.end_field).resolve(t)};return[M.a.min(t,e),M.a.max(t,s)]}return super._getDataExtent.call(this,t,e)}getTicks(t,e){if(-1===["x","y1","y2"].indexOf(t))throw new Error("Invalid dimension identifier"+t);if(t==="y"+this.layout.y_axis.axis){const t=this.layout.y_axis.category_field;if(!t)throw new Error("Layout for "+this.layout.id+" must specify category_field");return this.data.map((function(e,i){return{y:i+1,text:e[t]}}))}return[]}applyCustomDataMethods(){const t=this.layout.y_axis.field;if(!t)throw new Error("Layout for "+this.layout.id+" must specify yaxis.field");return this.data=this.data.map((function(e,i){return e[t]=i+1,e})),this.layout.y_axis.floor=0,this.layout.y_axis.ceiling=this.data.length+1,this}}const bt={stroke:"rgb(54, 54, 150)",color:"#363696",label_font_size:12,label_exon_spacing:4,exon_height:16,bounding_box_padding:6,track_vertical_spacing:10,tooltip_positioning:"top"};var vt=class extends ut{constructor(t){t=A(t,bt),super(...arguments),this.transcript_idx=0,this.tracks=1,this.gene_track_index={1:[]}}getElementStatusNodeId(t){return this.getElementId(t)+"-statusnode"}getTrackHeight(){return 2*this.layout.bounding_box_padding+this.layout.label_font_size+this.layout.label_exon_spacing+this.layout.exon_height+this.layout.track_vertical_spacing}assignTracks(){return this.getLabelWidth=function(t,e){try{const i=this.svg.group.append("text").attr("x",0).attr("y",0).attr("class","lz-data_layer-genes lz-label").style("font-size",e).text(t+"→"),s=i.node().getBBox().width;return i.remove(),s}catch(t){return 0}},this.tracks=1,this.gene_track_index={1:[]},this.data.map(function(t,e){if(this.data[e].gene_id&&this.data[e].gene_id.indexOf(".")){const t=this.data[e].gene_id.split(".");this.data[e].gene_id=t[0],this.data[e].gene_version=t[1]}if(this.data[e].transcript_id=this.data[e].transcripts[this.transcript_idx].transcript_id,this.data[e].display_range={start:this.parent.x_scale(Math.max(t.start,this.state.start)),end:this.parent.x_scale(Math.min(t.end,this.state.end))},this.data[e].display_range.label_width=this.getLabelWidth(this.data[e].gene_name,this.layout.label_font_size),this.data[e].display_range.width=this.data[e].display_range.end-this.data[e].display_range.start,this.data[e].display_range.text_anchor="middle",this.data[e].display_range.width<this.data[e].display_range.label_width){if(t.start<this.state.start)this.data[e].display_range.end=this.data[e].display_range.start+this.data[e].display_range.label_width+this.layout.label_font_size,this.data[e].display_range.text_anchor="start";else if(t.end>this.state.end)this.data[e].display_range.start=this.data[e].display_range.end-this.data[e].display_range.label_width-this.layout.label_font_size,this.data[e].display_range.text_anchor="end";else{const t=(this.data[e].display_range.label_width-this.data[e].display_range.width)/2+this.layout.label_font_size;this.data[e].display_range.start-t<this.parent.x_scale(this.state.start)?(this.data[e].display_range.start=this.parent.x_scale(this.state.start),this.data[e].display_range.end=this.data[e].display_range.start+this.data[e].display_range.label_width,this.data[e].display_range.text_anchor="start"):this.data[e].display_range.end+t>this.parent.x_scale(this.state.end)?(this.data[e].display_range.end=this.parent.x_scale(this.state.end),this.data[e].display_range.start=this.data[e].display_range.end-this.data[e].display_range.label_width,this.data[e].display_range.text_anchor="end"):(this.data[e].display_range.start-=t,this.data[e].display_range.end+=t)}this.data[e].display_range.width=this.data[e].display_range.end-this.data[e].display_range.start}this.data[e].display_range.start-=this.layout.bounding_box_padding,this.data[e].display_range.end+=this.layout.bounding_box_padding,this.data[e].display_range.width+=2*this.layout.bounding_box_padding,this.data[e].display_domain={start:this.parent.x_scale.invert(this.data[e].display_range.start),end:this.parent.x_scale.invert(this.data[e].display_range.end)},this.data[e].display_domain.width=this.data[e].display_domain.end-this.data[e].display_domain.start,this.data[e].track=null;let i=1;for(;null===this.data[e].track;){let t=!1;this.gene_track_index[i].map(function(e){if(!t){const i=Math.min(e.display_range.start,this.display_range.start);Math.max(e.display_range.end,this.display_range.end)-i<e.display_range.width+this.display_range.width&&(t=!0)}}.bind(this.data[e])),t?(i++,i>this.tracks&&(this.tracks=i,this.gene_track_index[i]=[])):(this.data[e].track=i,this.gene_track_index[i].push(this.data[e]))}this.data[e].parent=this,this.data[e].transcripts.map(function(t,i){this.data[e].transcripts[i].parent=this.data[e],this.data[e].transcripts[i].exons.map(function(t,s){this.data[e].transcripts[i].exons[s].parent=this.data[e].transcripts[i]}.bind(this))}.bind(this))}.bind(this)),this}render(){const t=this;let e,i,s,a;this.assignTracks();const n=this.svg.group.selectAll("g.lz-data_layer-genes").data(this.data,(function(t){return t.gene_name}));n.enter().append("g").attr("class","lz-data_layer-genes"),n.attr("id",function(t){return this.getElementId(t)}.bind(this)).each((function(n){const o=n.parent,r=M.a.select(this).selectAll("rect.lz-data_layer-genes.lz-data_layer-genes-statusnode").data([n],(function(t){return o.getElementStatusNodeId(t)}));r.enter().append("rect").attr("class","lz-data_layer-genes lz-data_layer-genes-statusnode"),r.attr("id",(function(t){return o.getElementStatusNodeId(t)})).attr("rx",(function(){return o.layout.bounding_box_padding})).attr("ry",(function(){return o.layout.bounding_box_padding})),e=function(t){return t.display_range.width},i=function(){return o.getTrackHeight()-o.layout.track_vertical_spacing},s=function(t){return t.display_range.start},a=function(t){return(t.track-1)*o.getTrackHeight()},r.attr("width",e).attr("height",i).attr("x",s).attr("y",a),r.exit().remove();const l=M.a.select(this).selectAll("rect.lz-data_layer-genes.lz-boundary").data([n],(function(t){return t.gene_name+"_boundary"})).style({fill:function(e,i){return t.resolveScalableParameter(t.layout.color,e,i)},stroke:function(e,i){return t.resolveScalableParameter(t.layout.stroke,e,i)}});l.enter().append("rect").attr("class","lz-data_layer-genes lz-boundary"),e=function(t){return o.parent.x_scale(t.end)-o.parent.x_scale(t.start)},i=function(){return 1},s=function(t){return o.parent.x_scale(t.start)},a=function(t){return(t.track-1)*o.getTrackHeight()+o.layout.bounding_box_padding+o.layout.label_font_size+o.layout.label_exon_spacing+Math.max(o.layout.exon_height,3)/2},l.attr("width",e).attr("height",i).attr("x",s).attr("y",a),l.exit().remove();const h=M.a.select(this).selectAll("text.lz-data_layer-genes.lz-label").data([n],(function(t){return t.gene_name+"_label"}));h.enter().append("text").attr("class","lz-data_layer-genes lz-label"),h.attr("text-anchor",(function(t){return t.display_range.text_anchor})).text((function(t){return"+"===t.strand?t.gene_name+"→":"←"+t.gene_name})).style("font-size",n.parent.layout.label_font_size),s=function(t){return"middle"===t.display_range.text_anchor?t.display_range.start+t.display_range.width/2:"start"===t.display_range.text_anchor?t.display_range.start+o.layout.bounding_box_padding:"end"===t.display_range.text_anchor?t.display_range.end-o.layout.bounding_box_padding:void 0},a=function(t){return(t.track-1)*o.getTrackHeight()+o.layout.bounding_box_padding+o.layout.label_font_size},h.attr("x",s).attr("y",a),h.exit().remove();const d=M.a.select(this).selectAll("rect.lz-data_layer-genes.lz-exon").data(n.transcripts[n.parent.transcript_idx].exons,(function(t){return t.exon_id}));d.enter().append("rect").attr("class","lz-data_layer-genes lz-exon"),d.style({fill:function(e,i){return t.resolveScalableParameter(t.layout.color,e.parent.parent,i)},stroke:function(e,i){return t.resolveScalableParameter(t.layout.stroke,e.parent.parent,i)}}),e=function(t){return o.parent.x_scale(t.end)-o.parent.x_scale(t.start)},i=function(){return o.layout.exon_height},s=function(t){return o.parent.x_scale(t.start)},a=function(){return(n.track-1)*o.getTrackHeight()+o.layout.bounding_box_padding+o.layout.label_font_size+o.layout.label_exon_spacing},d.attr("width",e).attr("height",i).attr("x",s).attr("y",a),d.exit().remove();const c=M.a.select(this).selectAll("rect.lz-data_layer-genes.lz-clickarea").data([n],(function(t){return t.gene_name+"_clickarea"}));c.enter().append("rect").attr("class","lz-data_layer-genes lz-clickarea"),c.attr("id",(function(t){return o.getElementId(t)+"_clickarea"})).attr("rx",(function(){return o.layout.bounding_box_padding})).attr("ry",(function(){return o.layout.bounding_box_padding})),e=function(t){return t.display_range.width},i=function(){return o.getTrackHeight()-o.layout.track_vertical_spacing},s=function(t){return t.display_range.start},a=function(t){return(t.track-1)*o.getTrackHeight()},c.attr("width",e).attr("height",i).attr("x",s).attr("y",a),c.exit().remove(),c.on("click.event_emitter",(function(t){t.parent.parent.emit("element_clicked",t,!0)})),o.applyBehaviors(c)})),n.exit().remove()}_getTooltipPosition(t){const e=this.getElementStatusNodeId(t.data),i=M.a.select("#"+e).node().getBBox();return{x_min:this.parent.x_scale(t.data.start),x_max:this.parent.x_scale(t.data.end),y_min:i.y,y_max:i.y+i.height}}};const wt={style:{fill:"none","stroke-width":"2px"},interpolate:"linear",x_axis:{field:"x"},y_axis:{field:"y",axis:1},hitarea_width:5};class zt extends ut{constructor(t){if((t=A(t,wt)).tooltip)throw new Error("The line / filled curve layer does not support tooltips");super(...arguments)}render(){const t=this.parent,e=this.layout.x_axis.field,i=this.layout.y_axis.field,s="y"+this.layout.y_axis.axis+"_scale",a=this.svg.group.selectAll("path.lz-data_layer-line").data([this.data]);let n;this.path=a.enter().append("path").attr("class","lz-data_layer-line"),n=this.layout.style.fill&&"none"!==this.layout.style.fill?M.a.svg.area().x((function(i){return parseFloat(t.x_scale(i[e]))})).y0((function(){return parseFloat(t[s](0))})).y1((function(e){return parseFloat(t[s](e[i]))})):M.a.svg.line().x((function(i){return parseFloat(t.x_scale(i[e]))})).y((function(e){return parseFloat(t[s](e[i]))})).interpolate(this.layout.interpolate),a.attr("d",n).style(this.layout.style),a.exit().remove()}setElementStatus(t,e,i){return this.setAllElementStatus(t,i)}setElementStatusByFilters(t,e){return this.setAllElementStatus(t,e)}setAllElementStatus(t,e){if(void 0===t||-1===P.adjectives.indexOf(t))throw new Error("Invalid status passed to DataLayer.setAllElementStatus()");if(void 0===this.layer_state.status_flags[t])return this;void 0===e&&(e=!0),this.global_statuses[t]=e;let i="lz-data_layer-line";return Object.keys(this.global_statuses).forEach(function(t){this.global_statuses[t]&&(i+=" lz-data_layer-line-"+t)}.bind(this)),this.path.attr("class",i),this.parent.emit("layout_changed",!0),this}}const kt={style:{stroke:"#D3D3D3","stroke-width":"3px","stroke-dasharray":"10px 10px"},orientation:"horizontal",x_axis:{axis:1,decoupled:!0},y_axis:{axis:1,decoupled:!0},tooltip_positioning:"vertical",offset:0};class Et extends ut{constructor(t){t=A(t,kt),-1===["horizontal","vertical"].indexOf(t.orientation)&&(t.orientation="horizontal"),super(...arguments),this.data=[]}getElementId(t){return this.getBaseId()}render(){const t=this.parent,e="y"+this.layout.y_axis.axis+"_scale",i="y"+this.layout.y_axis.axis+"_extent";if("horizontal"===this.layout.orientation)this.data=[{x:t.x_extent[0],y:this.layout.offset},{x:t.x_extent[1],y:this.layout.offset}];else{if("vertical"!==this.layout.orientation)throw new Error('Unrecognized vertical line type. Must be "vertical" or "horizontal"');this.data=[{x:this.layout.offset,y:t[i][0]},{x:this.layout.offset,y:t[i][1]}]}const s=this.svg.group.selectAll("path.lz-data_layer-line").data([this.data]);this.path=s.enter().append("path").attr("class","lz-data_layer-line");const a=[t.layout.cliparea.height,0],n=M.a.svg.line().x((function(e,i){const s=parseFloat(t.x_scale(e.x));return isNaN(s)?t.x_range[i]:s})).y((function(i,s){const n=parseFloat(t[e](i.y));return isNaN(n)?a[s]:n})).interpolate("linear");s.attr("d",n).style(this.layout.style),s.exit().remove(),this.applyBehaviors(s)}_getTooltipPosition(t){try{const t=M.a.mouse(this.svg.container.node()),e=t[0],i=t[1];return{x_min:e-1,x_max:e+1,y_min:i-1,y_max:i+1}}catch(t){return null}}}const Mt={point_size:40,point_shape:"circle",tooltip_positioning:"horizontal",color:"#888888",fill_opacity:1,y_axis:{axis:1},id_field:"id"};class Nt extends ut{constructor(t){(t=A(t,Mt)).label&&isNaN(t.label.spacing)&&(t.label.spacing=4),super(...arguments)}_getTooltipPosition(t){const e=this.parent.x_scale(t.data[this.layout.x_axis.field]),i="y"+this.layout.y_axis.axis+"_scale",s=this.parent[i](t.data[this.layout.y_axis.field]),a=this.resolveScalableParameter(this.layout.point_size,t.data),n=Math.sqrt(a/Math.PI);return{x_min:e-n,x_max:e+n,y_min:s-n,y_max:s+n}}flip_labels(){const t=this,e=t.resolveScalableParameter(t.layout.point_size,{}),i=t.layout.label.spacing,s=Boolean(t.layout.label.lines),a=2*i,n=t.parent.layout.width-t.parent.layout.margin.left-t.parent.layout.margin.right-2*i,o=function(t,a){const n=+t.attr("x"),o=2*i+2*Math.sqrt(e);let r,l;s&&(r=+a.attr("x2"),l=i+2*Math.sqrt(e)),"start"===t.style("text-anchor")?(t.style("text-anchor","end"),t.attr("x",n-o),s&&a.attr("x2",r-l)):(t.style("text-anchor","start"),t.attr("x",n+o),s&&a.attr("x2",r+l))};t.label_texts.each((function(e,a){const r=M.a.select(this);if(+r.attr("x")+r.node().getBoundingClientRect().width+i>n){const e=s?M.a.select(t.label_lines[0][a]):null;o(r,e)}})),t.label_texts.each((function(e,n){const r=M.a.select(this);if("end"===r.style("text-anchor"))return;let l=+r.attr("x");const h=r.node().getBoundingClientRect(),d=s?M.a.select(t.label_lines[0][n]):null;t.label_texts.each((function(){const t=M.a.select(this).node().getBoundingClientRect();h.left<t.left+t.width+2*i&&h.left+h.width+2*i>t.left&&h.top<t.top+t.height+2*i&&h.height+h.top+2*i>t.top&&(o(r,d),l=+r.attr("x"),l-h.width-i<a&&o(r,d))}))}))}separate_labels(){this.seperate_iterations++;const t=this;if(!this.layout.label)return;const e=this.layout.label.spacing;let i=!1;if(t.label_texts.each((function(){const s=this,a=M.a.select(s),n=a.attr("y");t.label_texts.each((function(){if(s===this)return;const o=M.a.select(this);if(a.attr("text-anchor")!==o.attr("text-anchor"))return;const r=a.node().getBoundingClientRect(),l=o.node().getBoundingClientRect();if(!(r.left<l.left+l.width+2*e&&r.left+r.width+2*e>l.left&&r.top<l.top+l.height+2*e&&r.height+r.top+2*e>l.top))return;i=!0;const h=o.attr("y"),d=.5*(r.top<l.top?1:-1);let c=+n-d,u=+h+d;const p=2*e,_=t.parent.layout.height-t.parent.layout.margin.top-t.parent.layout.margin.bottom-2*e;let y;c-r.height/2<p?(y=+n-c,c=+n,u+=y):u-l.height/2<p&&(y=+h-u,u=+h,c+=y),c+r.height/2>_?(y=c-+n,c=+n,u-=y):u+l.height/2>_&&(y=u-+h,u=+h,c-=y),a.attr("y",c),o.attr("y",u)}))})),i){if(t.layout.label.lines){const e=t.label_texts[0];t.label_lines.attr("y2",(function(t,i){return M.a.select(e[i]).attr("y")}))}this.seperate_iterations<150&&setTimeout(function(){this.separate_labels()}.bind(this),1)}}render(){const t=this,e=this,i="y"+this.layout.y_axis.axis+"_scale";if(this.layout.label){let s;const a=e.layout.label.filters||[];s=a.length?this.data.filter((function(e){let i=!0;return a.forEach((function(s){const a=t.layer_state.extra_fields[t.getElementId(e)],n=new O(s.field).resolve(e,a);if(-1===["!=","="].indexOf(s.operator)&&isNaN(n))i=!1;else switch(s.operator){case"<":n<s.value||(i=!1);break;case"<=":n<=s.value||(i=!1);break;case">":n>s.value||(i=!1);break;case">=":n>=s.value||(i=!1);break;case"=":n!==s.value&&(i=!1);break;case"!=":n==s.value&&(i=!1);break;default:i=!1}})),i})):this.data,this.label_groups=this.svg.group.selectAll("g.lz-data_layer-"+this.layout.type+"-label").data(s,(function(e){return e[t.layout.id_field]+"_label"})),this.label_groups.enter().append("g").attr("class","lz-data_layer-"+this.layout.type+"-label"),this.label_texts&&this.label_texts.remove(),this.label_texts=this.label_groups.append("text").attr("class","lz-data_layer-"+this.layout.type+"-label"),this.label_texts.text((function(t){return J(t,e.layout.label.text||"")})).style(e.layout.label.style||{}).attr({x:function(t){let i=e.parent.x_scale(t[e.layout.x_axis.field])+Math.sqrt(e.resolveScalableParameter(e.layout.point_size,t))+e.layout.label.spacing;return isNaN(i)&&(i=-1e3),i},y:function(t){let s=e.parent[i](t[e.layout.y_axis.field]);return isNaN(s)&&(s=-1e3),s},"text-anchor":function(){return"start"}}),e.layout.label.lines&&(this.label_lines&&this.label_lines.remove(),this.label_lines=this.label_groups.append("line").attr("class","lz-data_layer-"+this.layout.type+"-label"),this.label_lines.style(e.layout.label.lines.style||{}).attr({x1:function(t){let i=e.parent.x_scale(t[e.layout.x_axis.field]);return isNaN(i)&&(i=-1e3),i},y1:function(t){let s=e.parent[i](t[e.layout.y_axis.field]);return isNaN(s)&&(s=-1e3),s},x2:function(t){let i=e.parent.x_scale(t[e.layout.x_axis.field])+Math.sqrt(e.resolveScalableParameter(e.layout.point_size,t))+e.layout.label.spacing/2;return isNaN(i)&&(i=-1e3),i},y2:function(t){let s=e.parent[i](t[e.layout.y_axis.field]);return isNaN(s)&&(s=-1e3),s}})),this.label_groups.exit().remove()}else this.label_groups&&this.label_groups.remove(),this.label_lines&&this.label_lines.remove();const s=this.svg.group.selectAll("path.lz-data_layer-"+this.layout.type).data(this.data,(function(e){return e[t.layout.id_field]})),a=isNaN(this.parent.layout.height)?0:this.parent.layout.height;s.enter().append("path").attr("class","lz-data_layer-"+this.layout.type).attr("id",(function(e){return t.getElementId(e)})).attr("transform","translate(0,"+a+")");const n=function(t,e){return this.resolveScalableParameter(this.layout.color,t,e)}.bind(this),o=function(t,e){return this.resolveScalableParameter(this.layout.fill_opacity,t,e)}.bind(this),r=M.a.svg.symbol().size(function(t,e){return this.resolveScalableParameter(this.layout.point_size,t,e)}.bind(this)).type(function(t,e){return this.resolveScalableParameter(this.layout.point_shape,t,e)}.bind(this));s.attr("transform",(function(e){let s=t.parent.x_scale(e[t.layout.x_axis.field]),a=t.parent[i](e[t.layout.y_axis.field]);return isNaN(s)&&(s=-1e3),isNaN(a)&&(a=-1e3),"translate("+s+","+a+")"})).attr("fill",n).attr("fill-opacity",o).attr("d",r),s.exit().remove(),s.on("click.event_emitter",(function(e){t.parent.emit("element_clicked",e,!0)})),this.applyBehaviors(s),this.layout.label&&(this.flip_labels(),this.seperate_iterations=0,this.separate_labels(),this.label_texts.on("click.event_emitter",(function(e){t.parent.emit("element_clicked",e,!0)})),this.applyBehaviors(this.label_texts))}makeLDReference(t){let e=null;if(void 0===t)throw new Error("makeLDReference requires one argument of any type");e="object"==typeof t?this.layout.id_field&&void 0!==t[this.layout.id_field]?t[this.layout.id_field].toString():void 0!==t.id?t.id.toString():t.toString():t.toString(),this.parent_plot.applyState({ldrefvar:e})}}class St extends Nt{_prepareData(){const t=this.layout.x_axis.field||"x",e=this.layout.x_axis.category_field;if(!e)throw new Error("Layout for "+this.layout.id+" must specify category_field");const i=this.data.sort((function(t,i){const s=t[e],a=i[e],n="string"==typeof s?s.toLowerCase():s,o="string"==typeof a?a.toLowerCase():a;return n===o?0:n<o?-1:1}));return i.forEach((function(e,i){e[t]=e[t]||i})),i}_generateCategoryBounds(){const t=this.layout.x_axis.category_field,e=this.layout.x_axis.field||"x",i={};this.data.forEach((function(s){const a=s[t],n=s[e],o=i[a]||[n,n];i[a]=[Math.min(o[0],n),Math.max(o[1],n)]}));const s=Object.keys(i);return this._setDynamicColorScheme(s),i}_getColorScale(t){let e=(t=t||this.layout).color||[];if(Array.isArray(e)&&(e=e.find((function(t){return"categorical_bin"===t.scale_function}))),!e||"categorical_bin"!==e.scale_function)throw new Error("This layer requires that color options be provided as a `categorical_bin`");return e}_setDynamicColorScheme(t){const e=this._getColorScale(this.layout).parameters,i=this._getColorScale(this._base_layout).parameters;if(i.categories.length&&i.values.length){const s={};i.categories.forEach((function(t){s[t]=1})),t.every((function(t){return Object.prototype.hasOwnProperty.call(s,t)}))?e.categories=i.categories:e.categories=t}else e.categories=t;let s;if(i.values.length)s=i.values;else{s=(t.length<=10?M.a.scale.category10:M.a.scale.category20)().range()}for(;s.length<t.length;)s=s.concat(s);s=s.slice(0,t.length),e.values=s}getTicks(t,e){if(-1===["x","y1","y2"].indexOf(t))throw new Error("Invalid dimension identifier");const i=e.position||"left";if(-1===["left","center","right"].indexOf(i))throw new Error("Invalid tick position");const s=this._categories;if(!s||!Object.keys(s).length)return[];if("y"===t)return[];if("x"===t){const t=this._getColorScale(this.layout),e=t.parameters.categories||[],a=t.parameters.values||[];return Object.keys(s).map((function(t,n){const o=s[t];let r;switch(i){case"left":r=o[0];break;case"center":const t=o[1]-o[0];r=o[0]+(0!==t?t:o[0])/2;break;case"right":r=o[1]}return{x:r,text:t,style:{fill:a[e.indexOf(t)]||"#000000"}}}))}}applyCustomDataMethods(){return this.data=this._prepareData(),this._categories=this._generateCategoryBounds(),this}}const Ot=new d;for(let[t,e]of Object.entries(n))Ot.add(t,e);var At=Ot;const Tt={namespace:{assoc:"assoc"},closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:'<strong>{{{{namespace[assoc]}}variant|htmlescape}}</strong><br>P Value: <strong>{{{{namespace[assoc]}}log_pvalue|logtoscinotation|htmlescape}}</strong><br>Ref. Allele: <strong>{{{{namespace[assoc]}}ref_allele|htmlescape}}</strong><br><a href="javascript:void(0);" onclick="LocusZoom.getToolTipDataLayer(this).makeLDReference(LocusZoom.getToolTipData(this));">Make LD Reference</a><br>'},Lt=function(){const t=T(Tt);return t.html+="<a href=\"javascript:void(0);\" onclick=\"var item = LocusZoom.getToolTipData(this), layer = LocusZoom.getToolTipDataLayer(this); var current = layer.getElementAnnotation(item, 'lz_show_label'); layer.setElementAnnotation(item, 'lz_show_label', !current ); layer.parent_plot.applyState();\">Toggle label</a>",t}(),Dt={closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:'<h4><strong><i>{{gene_name|htmlescape}}</i></strong></h4>Gene ID: <a href="https://useast.ensembl.org/homo_sapiens/Gene/Summary?g={{gene_id|htmlescape}}&db=core" target="_blank" rel="noopener">{{gene_id|htmlescape}}</a><br>Transcript ID: <strong>{{transcript_id|htmlescape}}</strong><br>{{#if pLI}}<table><tr><th>Constraint</th><th>Expected variants</th><th>Observed variants</th><th>Const. Metric</th></tr><tr><td>Synonymous</td><td>{{exp_syn}}</td><td>{{obs_syn}}</td><td>z = {{syn_z}}<br>o/e = {{oe_syn}} ({{oe_syn_lower}} - {{oe_syn_upper}})</td></tr><tr><td>Missense</td><td>{{exp_mis}}</td><td>{{obs_mis}}</td><td>z = {{mis_z}}<br>o/e = {{oe_mis}} ({{oe_mis_lower}} - {{oe_mis_upper}})</td></tr><tr><td>pLoF</td><td>{{exp_lof}}</td><td>{{obs_lof}}</td><td>pLI = {{pLI}}<br>o/e = {{oe_lof}} ({{oe_lof_lower}} - {{oe_lof_upper}})</td></tr></table><br>{{/if}}<a href="https://gnomad.broadinstitute.org/gene/{{gene_id|htmlescape}}" target="_blank" rel="noopener">More data on gnomAD</a>'},Pt={namespace:{assoc:"assoc",catalog:"catalog"},closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:'<strong>{{{{namespace[catalog]}}variant|htmlescape}}</strong><br>Catalog entries: <strong>{{n_catalog_matches|htmlescape}}</strong><br>Top Trait: <strong>{{{{namespace[catalog]}}trait|htmlescape}}</strong><br>Top P Value: <strong>{{{{namespace[catalog]}}log_pvalue|logtoscinotation}}</strong><br>More: <a href="https://www.ebi.ac.uk/gwas/search?query={{{{namespace[catalog]}}rsid|htmlescape}}" target="_blank" rel="noopener">GWAS catalog</a> / <a href="https://www.ncbi.nlm.nih.gov/snp/{{{{namespace[catalog]}}rsid|htmlescape}}" target="_blank" rel="noopener">dbSNP</a>'},It={namespace:{access:"access"},closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:"<strong>Regulatory element</strong><br>{{{{namespace[access]}}start1|htmlescape}}-{{{{namespace[access]}}end1|htmlescape}}<br><strong>Promoter</strong><br>{{{{namespace[access]}}start2|htmlescape}}-{{{{namespace[access]}}end2|htmlescape}}<br>{{#if {{namespace[access]}}target}}<strong>Target</strong>: {{{{namespace[access]}}target|htmlescape}}<br>{{/if}}<strong>Score</strong>: {{{{namespace[access]}}score|htmlescape}}"},Rt={id:"significance",type:"orthogonal_line",orientation:"horizontal",offset:7.301},jt={namespace:{recomb:"recomb"},id:"recombrate",type:"line",fields:["{{namespace[recomb]}}position","{{namespace[recomb]}}recomb_rate"],z_index:1,style:{stroke:"#0000FF","stroke-width":"1.5px"},x_axis:{field:"{{namespace[recomb]}}position"},y_axis:{axis:2,field:"{{namespace[recomb]}}recomb_rate",floor:0,ceiling:100}},Bt={namespace:{assoc:"assoc",ld:"ld"},id:"associationpvalues",type:"scatter",point_shape:{scale_function:"if",field:"{{namespace[ld]}}isrefvar",parameters:{field_value:1,then:"diamond",else:"circle"}},point_size:{scale_function:"if",field:"{{namespace[ld]}}isrefvar",parameters:{field_value:1,then:80,else:40}},color:[{scale_function:"if",field:"{{namespace[ld]}}isrefvar",parameters:{field_value:1,then:"#9632b8"}},{scale_function:"numerical_bin",field:"{{namespace[ld]}}state",parameters:{breaks:[0,.2,.4,.6,.8],values:["#357ebd","#46b8da","#5cb85c","#eea236","#d43f3a"]}},"#B8B8B8"],legend:[{shape:"diamond",color:"#9632b8",size:40,label:"LD Ref Var",class:"lz-data_layer-scatter"},{shape:"circle",color:"#d43f3a",size:40,label:"1.0 > r² ≥ 0.8",class:"lz-data_layer-scatter"},{shape:"circle",color:"#eea236",size:40,label:"0.8 > r² ≥ 0.6",class:"lz-data_layer-scatter"},{shape:"circle",color:"#5cb85c",size:40,label:"0.6 > r² ≥ 0.4",class:"lz-data_layer-scatter"},{shape:"circle",color:"#46b8da",size:40,label:"0.4 > r² ≥ 0.2",class:"lz-data_layer-scatter"},{shape:"circle",color:"#357ebd",size:40,label:"0.2 > r² ≥ 0.0",class:"lz-data_layer-scatter"},{shape:"circle",color:"#B8B8B8",size:40,label:"no r² data",class:"lz-data_layer-scatter"}],label:null,fields:["{{namespace[assoc]}}variant","{{namespace[assoc]}}position","{{namespace[assoc]}}log_pvalue","{{namespace[assoc]}}log_pvalue|logtoscinotation","{{namespace[assoc]}}ref_allele","{{namespace[ld]}}state","{{namespace[ld]}}isrefvar"],id_field:"{{namespace[assoc]}}variant",z_index:2,x_axis:{field:"{{namespace[assoc]}}position"},y_axis:{axis:1,field:"{{namespace[assoc]}}log_pvalue",floor:0,upper_buffer:.1,min_extent:[0,10]},behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}],onshiftclick:[{action:"toggle",status:"selected"}]},tooltip:T(Tt)},Ct={namespace:{access:"access"},id:"coaccessibility",type:"arcs",fields:["{{namespace[access]}}start1","{{namespace[access]}}end1","{{namespace[access]}}start2","{{namespace[access]}}end2","{{namespace[access]}}id","{{namespace[access]}}target","{{namespace[access]}}score"],match:{send:"{{namespace[access]}}target",receive:"{{namespace[access]}}target"},id_field:"{{namespace[access]}}id",filters:[["{{namespace[access]}}score","!=",null]],color:[{field:"lz_highlight_match",scale_function:"if",parameters:{field_value:!0,then:"#ff0000"}},{field:"lz_highlight_match",scale_function:"if",parameters:{field_value:!1,then:"#EAE6E6"}},{scale_function:"ordinal_cycle",parameters:{values:M.a.scale.category20().range()}}],x_axis:{field1:"{{namespace[access]}}start1",field2:"{{namespace[access]}}start2"},y_axis:{axis:1,field:"{{namespace[access]}}score",upper_buffer:.1,min_extent:[0,1]},behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}],onshiftclick:[{action:"toggle",status:"selected"}]},tooltip:T(It)},Ft=function(){let t=T(Bt);return t=A({id:"associationpvaluescatalog",fill_opacity:.7},t),t.tooltip.html+='{{#if {{namespace[catalog]}}rsid}}<br><a href="https://www.ebi.ac.uk/gwas/search?query={{{{namespace[catalog]}}rsid|htmlescape}}" target="_blank" rel="noopener">See hits in GWAS catalog</a>{{/if}}',t.namespace.catalog="catalog",t.fields.push("{{namespace[catalog]}}rsid","{{namespace[catalog]}}trait","{{namespace[catalog]}}log_pvalue"),t}(),Ut={namespace:{phewas:"phewas"},id:"phewaspvalues",type:"category_scatter",point_shape:"circle",point_size:70,tooltip_positioning:"vertical",id_field:"{{namespace[phewas]}}id",fields:["{{namespace[phewas]}}id","{{namespace[phewas]}}log_pvalue","{{namespace[phewas]}}trait_group","{{namespace[phewas]}}trait_label"],x_axis:{field:"{{namespace[phewas]}}x",category_field:"{{namespace[phewas]}}trait_group",lower_buffer:.025,upper_buffer:.025},y_axis:{axis:1,field:"{{namespace[phewas]}}log_pvalue",floor:0,upper_buffer:.15},color:[{field:"{{namespace[phewas]}}trait_group",scale_function:"categorical_bin",parameters:{categories:[],values:[],null_value:"#B8B8B8"}}],fill_opacity:.7,tooltip:{closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:["<strong>Trait:</strong> {{{{namespace[phewas]}}trait_label|htmlescape}}<br>","<strong>Trait Category:</strong> {{{{namespace[phewas]}}trait_group|htmlescape}}<br>","<strong>P-value:</strong> {{{{namespace[phewas]}}log_pvalue|logtoscinotation|htmlescape}}<br>"].join("")},behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}],onshiftclick:[{action:"toggle",status:"selected"}]},label:{text:"{{{{namespace[phewas]}}trait_label|htmlescape}}",spacing:6,lines:{style:{"stroke-width":"2px",stroke:"#333333","stroke-dasharray":"2px 2px"}},filters:[{field:"{{namespace[phewas]}}log_pvalue",operator:">=",value:20}],style:{"font-size":"14px","font-weight":"bold",fill:"#333333"}}},qt={namespace:{gene:"gene",constraint:"constraint"},id:"genes",type:"genes",fields:["{{namespace[gene]}}all","{{namespace[constraint]}}all"],id_field:"gene_id",behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}],onshiftclick:[{action:"toggle",status:"selected"}]},tooltip:T(Dt)},Zt={namespace:{assoc:"assoc",catalog:"catalog"},id:"annotation_catalog",type:"annotation_track",id_field:"{{namespace[catalog]}}variant",x_axis:{field:"{{namespace[assoc]}}position"},color:"#0000CC",fields:["{{namespace[assoc]}}variant","{{namespace[assoc]}}chromosome","{{namespace[assoc]}}position","{{namespace[catalog]}}variant","{{namespace[catalog]}}rsid","{{namespace[catalog]}}trait","{{namespace[catalog]}}log_pvalue","{{namespace[catalog]}}pos"],filters:[["{{namespace[catalog]}}rsid","!=",null],["{{namespace[catalog]}}log_pvalue",">",7.301]],behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}],onshiftclick:[{action:"toggle",status:"selected"}]},tooltip:T(Pt),tooltip_positioning:"top"},Ht={components:[{type:"remove_panel",position:"right",color:"red",group_position:"end"},{type:"move_panel_up",position:"right",group_position:"middle"},{type:"move_panel_down",position:"right",group_position:"start",style:{"margin-left":"0.75em"}}]},Gt={components:[{type:"title",title:"LocusZoom",subtitle:'<a href="https://statgen.github.io/locuszoom/" target="_blank" rel="noopener">v'+h.a+"</a>",position:"left"},{type:"download",position:"right"}]},Jt=function(){const t=T(Gt);return t.components.push({type:"shift_region",step:5e5,button_html:">>",position:"right",group_position:"end"},{type:"shift_region",step:5e4,button_html:">",position:"right",group_position:"middle"},{type:"zoom_region",step:.2,position:"right",group_position:"middle"},{type:"zoom_region",step:-.2,position:"right",group_position:"middle"},{type:"shift_region",step:-5e4,button_html:"<",position:"right",group_position:"middle"},{type:"shift_region",step:-5e5,button_html:"<<",position:"right",group_position:"start"}),t}(),Kt={id:"association",width:800,height:225,min_width:400,min_height:200,proportional_width:1,margin:{top:35,right:50,bottom:40,left:50},inner_border:"rgb(210, 210, 210)",dashboard:function(){const t=T(Ht);return t.components.push({type:"toggle_legend",position:"right"}),t}(),axes:{x:{label:"Chromosome {{chr}} (Mb)",label_offset:32,tick_format:"region",extent:"state"},y1:{label:"-log10 p-value",label_offset:28},y2:{label:"Recombination Rate (cM/Mb)",label_offset:40}},legend:{orientation:"vertical",origin:{x:55,y:40},hidden:!0},interaction:{drag_background_to_pan:!0,drag_x_ticks_to_scale:!0,drag_y1_ticks_to_scale:!0,drag_y2_ticks_to_scale:!0,scroll_to_zoom:!0,x_linked:!0},data_layers:[T(Rt),T(jt),T(Bt)]},$t={id:"coaccessibility",width:800,height:225,min_width:400,min_height:100,proportional_width:1,margin:{top:35,right:50,bottom:40,left:50},inner_border:"rgb(210, 210, 210)",dashboard:T(Ht),axes:{x:{label:"Chromosome {{chr}} (Mb)",label_offset:32,tick_format:"region",extent:"state"},y1:{label:"Score",label_offset:28,render:!1}},interaction:{drag_background_to_pan:!0,drag_x_ticks_to_scale:!0,drag_y1_ticks_to_scale:!0,scroll_to_zoom:!0,x_linked:!0},data_layers:[T(Ct)]},Vt=function(){let t=T(Kt);return t=A({id:"associationcatalog",namespace:{assoc:"assoc",ld:"ld",catalog:"catalog"}},t),t.dashboard.components.push({type:"display_options",position:"right",color:"blue",button_html:"Display options...",button_title:"Control how plot items are displayed",layer_name:"associationpvaluescatalog",default_config_display_name:"No catalog labels (default)",options:[{display_name:"Label catalog traits",display:{label:{text:"{{{{namespace[catalog]}}trait|htmlescape}}",spacing:6,lines:{style:{"stroke-width":"2px",stroke:"#333333","stroke-dasharray":"2px 2px"}},filters:[{field:"{{namespace[catalog]}}trait",operator:"!=",value:null},{field:"{{namespace[catalog]}}log_pvalue",operator:">",value:7.301},{field:"{{namespace[ld]}}state",operator:">",value:.4}],style:{"font-size":"10px","font-weight":"bold",fill:"#333333"}}}}]}),t.data_layers=[T(Rt),T(jt),T(Ft)],t}(),Wt={id:"genes",width:800,height:225,min_width:400,min_height:112.5,proportional_width:1,margin:{top:20,right:50,bottom:20,left:50},axes:{},interaction:{drag_background_to_pan:!0,scroll_to_zoom:!0,x_linked:!0},dashboard:function(){const t=T(Ht);return t.components.push({type:"resize_to_data",position:"right",button_html:"Show all genes"}),t}(),data_layers:[T(qt)]},Yt={id:"phewas",width:800,height:300,min_width:800,min_height:300,proportional_width:1,margin:{top:20,right:50,bottom:120,left:50},inner_border:"rgb(210, 210, 210)",axes:{x:{ticks:{style:{"font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"rotate(50)",position:"left"}},y1:{label:"-log10 p-value",label_offset:28}},data_layers:[T(Rt),T(Ut)]},Qt={id:"annotationcatalog",width:800,height:50,min_height:50,proportional_width:1,margin:{top:25,right:50,bottom:0,left:50},inner_border:"rgb(210, 210, 210)",dashboard:T(Ht),interaction:{drag_background_to_pan:!0,scroll_to_zoom:!0,x_linked:!0},data_layers:[T(Zt)]},Xt={state:{},width:800,height:450,responsive_resize:"both",min_region_scale:2e4,max_region_scale:1e6,dashboard:T(Gt),panels:[A({proportional_height:.5},T(Kt)),A({proportional_height:.5},T(Wt))]},te={state:{},width:800,height:500,responsive_resize:"width_only",min_region_scale:2e4,max_region_scale:1e6,dashboard:T(Gt),panels:[T(Qt),T(Vt),T(Wt)]},ee={width:800,height:600,min_width:800,min_height:600,responsive_resize:"both",dashboard:T(Gt),panels:[A({proportional_height:.5},T(Yt)),A({proportional_height:.5,margin:{bottom:40},axes:{x:{label:"Chromosome {{chr}} (Mb)",label_offset:32,tick_format:"region",extent:"state"}}},T(Wt))],mouse_guide:!1},ie={state:{},width:800,height:450,responsive_resize:"both",min_region_scale:2e4,max_region_scale:1e6,dashboard:T(Jt),panels:[Object.assign({proportional_height:.4},T($t)),function(){const t=Object.assign({proportional_height:.6},T(Wt)),e=t.data_layers[0];e.match={send:"gene_name",receive:"gene_name"};const i=[{field:"lz_highlight_match",scale_function:"if",parameters:{field_value:!0,then:"#ff0000"}},{field:"lz_highlight_match",scale_function:"if",parameters:{field_value:!1,then:"#EAE6E6"}},"#363696"];return e.color=i,e.stroke=i,t}()]},se={standard_asociation:Tt,standard_association_with_label:Lt,standard_genes:Dt,catalog_variant:Pt,coaccessibility:It},ae={ldlz2_pop_selector:{type:"set_state",position:"right",color:"blue",button_html:"LD Population: ",show_selected:!0,button_title:"Select LD Population: ",state_field:"ld_pop",options:[{display_name:"ALL (default)",value:"ALL"},{display_name:"AFR",value:"AFR"},{display_name:"AMR",value:"AMR"},{display_name:"EAS",value:"EAS"},{display_name:"EUR",value:"EUR"},{display_name:"SAS",value:"SAS"}]}},ne={standard_panel:Ht,standard_plot:Gt,region_nav_plot:Jt},oe={significance:Rt,recomb_rate:jt,association_pvalues:Bt,coaccessibility:Ct,association_pvalues_catalog:Ft,phewas_pvalues:Ut,genes:qt,annotation_catalog:Zt},re={association:Kt,coaccessibility:$t,association_catalog:Vt,genes:Wt,phewas:Yt,annotation_catalog:Qt},le={standard_association:Xt,association_catalog:te,standard_phewas:ee,coaccessibility:ie};const he=new class extends d{get(t,e,i={}){if(!t||!e)throw new Error("Must specify both the type and name for the layout desired. See .list() for available options");let s=super.get(t).get(e);if(s=A(i,s),s.unnamespaced)return delete s.unnamespaced,JSON.parse(JSON.stringify(s));let a="";"string"==typeof s.namespace?a=s.namespace:"object"==typeof s.namespace&&Object.keys(s.namespace).length&&(a=void 0!==s.namespace.default?s.namespace.default:s.namespace[Object.keys(s.namespace)[0]].toString()),a+=a.length?":":"";const n=function t(e,i,s){if(i?"string"==typeof i&&(i={default:i}):i={default:""},"string"==typeof e){const t=/\{\{namespace(\[[A-Za-z_0-9]+\]|)\}\}/g;let a,n,o,r;const l=[];for(;null!==(a=t.exec(e));)n=a[0],o=a[1].length?a[1].replace(/(\[|\])/g,""):null,r=s,null!=i&&"object"==typeof i&&void 0!==i[o]&&(r=i[o]+(i[o].length?":":"")),l.push({base:n,namespace:r});for(let t in l)e=e.replace(l[t].base,l[t].namespace)}else if("object"==typeof e&&null!=e){if(void 0!==e.namespace){i=A(i,"string"==typeof e.namespace?{default:e.namespace}:e.namespace)}let a,n;for(let o in e)"namespace"!==o&&(a=t(e[o],i,s),n=t(o,i,s),o!==n&&delete e[o],e[n]=a)}return e}(s,s.namespace,a);return JSON.parse(JSON.stringify(n))}add(t,e,i,s=!1){if(!(t&&e&&i))throw new Error("To add a layout, type, name, and item must all be specified");if("object"!=typeof i)throw new Error("The configuration to be added must be an object");this.has(t)||super.add(t,new d);const a=JSON.parse(JSON.stringify(i));return super.get(t).add(e,a,s)}list(t){if(!t){let t={};for(let[e,i]of this._items)t[e]=i.list();return t}return super.get(t).list()}};for(let[t,e]of Object.entries(o))for(let[i,s]of Object.entries(e))he.add(t,i,s);var de=he;const ce=(t,e)=>void 0===e||t.field_value!==e?void 0!==t.else?t.else:null:t.then,ue=(t,e)=>{const i=t.breaks||[],s=t.values||[];if(null==e||isNaN(+e))return t.null_value?t.null_value:null;const a=i.reduce((function(t,i){return+e<t||+e>=t&&+e<i?t:i}));return s[i.indexOf(a)]},pe=(t,e)=>void 0===e||-1===t.categories.indexOf(e)?t.null_value?t.null_value:null:t.values[t.categories.indexOf(e)],_e=(t,e,i)=>{var s=t.values;return s[i%s.length]},ye=(t,e)=>{var i=t.breaks||[],s=t.values||[],a=t.null_value?t.null_value:null;if(i.length<2||i.length!==s.length)return a;if(null==e||isNaN(+e))return a;if(+e<=t.breaks[0])return s[0];if(+e>=t.breaks[t.breaks.length-1])return s[i.length-1];{var n=null;if(i.forEach((function(t,s){s&&i[s-1]<=+e&&i[s]>=+e&&(n=s)})),null===n)return a;const t=(+e-i[n-1])/(i[n]-i[n-1]);return isFinite(t)?M.a.interpolate(s[n-1],s[n])(t):a}},ge=new d;for(let[t,e]of Object.entries(r))ge.add(t,e);ge.add("if",ce);var fe=ge;function me(t){return isNaN(t)||t<=0?null:-Math.log(t)/Math.LN10}function xe(t){if(isNaN(t))return"NaN";if(0===t)return"1";const e=Math.ceil(t),i=e-t,s=Math.pow(10,i);return 1===e?(s/10).toFixed(4):2===e?(s/100).toFixed(3):s.toFixed(2)+" × 10^-"+e}function be(t){if(isNaN(t))return"NaN";if(0===t)return"0";const e=Math.abs(t);let i;return i=e>1?Math.ceil(Math.log(e)/Math.LN10):Math.floor(Math.log(e)/Math.LN10),Math.abs(i)<=3?t.toFixed(3):t.toExponential(2).replace("+","").replace("e"," × 10^")}function ve(t){return t?(t+="").replace(/['"<>&`]/g,(function(t){switch(t){case"'":return"&#039;";case'"':return"&quot;";case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"`":return"&#x60;"}})):""}function we(t){return encodeURIComponent(t)}const ze=new class extends d{_collectTransforms(t){const e=t.match(/\|([^|]+)/g).map(t=>super.get(t.substring(1)));return t=>e.reduce((t,e)=>e(t),t)}get(t){return t?"|"===t.substring(0,1)?this._collectTransforms(t):super.get(t):null}};for(let[t,e]of Object.entries(l))ze.add(t,e);var ke=ze;var Ee=class extends d{constructor(t){super(),this._registry=t||k}add(t,e,i=!1){if(this._registry.has(t))throw new Error(`The namespace ${t} is already in use by another source`);if(t.match(/[^A-Za-z0-9_]/))throw new Error("Data source namespace names can contain alphanumeric characters or underscores");if(Array.isArray(e)){const[t,i]=e;e=this._registry.create(t,i)}return e.source_id=t,super.add(t,e,i),this}}}]);
//# sourceMappingURL=locuszoom.app.min.js.map